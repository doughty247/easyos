<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="color-scheme" content="light">
    <title>easeOS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'ease': {
                            'leaf': '#22C55E',
                            'mint': '#86EFAC',
                            'sage': '#4ADE80',
                            'forest': '#166534',
                            'cream': '#F0FDF4',
                            'soil': '#365314',
                            'terracotta': '#EA580C',
                            'clay': '#FFEDD5',
                        },
                        'night': {
                            'sky': '#0f172a',
                            'deep': '#1e293b',
                            'cloud': '#334155',
                            'star': '#fef3c7',
                            'moon': '#fef9c3',
                            'glow': '#a5b4fc',
                        }
                    },
                    fontFamily: {
                        'nunito': ['Nunito', 'sans-serif'],
                    },
                    boxShadow: {
                        'soft': '0 8px 30px rgba(34, 197, 94, 0.15)',
                        'glow': '0 0 20px rgba(34, 197, 94, 0.3)',
                        'card': '0 10px 40px rgba(0, 0, 0, 0.08)',
                        'btn': '0 6px 0 #166534',
                        'btn-hover': '0 4px 0 #166534',
                    }
                }
            }
        }
    </script>
    <style>
        [x-cloak] { display: none !important; }
        
        /* Force light mode on all inputs - aggressive mobile override */
        input, textarea, select {
            color-scheme: light !important;
            -webkit-appearance: none;
            appearance: none;
            background-color: #ffffff !important;
            background: #ffffff !important;
            color: #1f2937 !important;
            -webkit-text-fill-color: #1f2937 !important;
            opacity: 1 !important;
        }
        
        input::placeholder {
            color: #9ca3af !important;
            -webkit-text-fill-color: #9ca3af !important;
            opacity: 1 !important;
        }
        
        /* Setup wizard inputs must always be light - override night mode */
        .setup-card input,
        .setup-card-container input,
        .setup-card textarea,
        .setup-card select,
        .password-field input,
        .wifi-bubble input,
        .night-mode .setup-card input,
        .night-mode .setup-card-container input,
        .night-mode .password-field input,
        .night-mode .wifi-bubble input {
            background-color: #ffffff !important;
            background: #ffffff !important;
            color: #1f2937 !important;
            -webkit-text-fill-color: #1f2937 !important;
            border-color: #e5e7eb !important;
        }
        
        .setup-card input::placeholder,
        .password-field input::placeholder,
        .night-mode .setup-card input::placeholder,
        .night-mode .password-field input::placeholder {
            color: #9ca3af !important;
            -webkit-text-fill-color: #9ca3af !important;
        }
        
        .bg-pattern {
            background-image: 
                radial-gradient(circle at 20% 80%, rgba(134, 239, 172, 0.35) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(74, 222, 128, 0.25) 0%, transparent 50%),
                radial-gradient(circle at 50% 50%, rgba(34, 197, 94, 0.1) 0%, transparent 70%);
        }
        
        /* ===== TIME-BASED THEMES ===== */
        
        /* Sunrise theme (6am - 9am) */
        .sunrise-mode {
            background: linear-gradient(to bottom, 
                #fcd34d 0%, 
                #fdba74 20%, 
                #fca5a5 40%, 
                #fb7185 60%,
                #60a5fa 100%) !important;
        }
        
        .sunrise-mode .bg-pattern {
            background-image: none !important;
        }
        
        /* Day theme (9am - 5pm) - blue sky */
        .day-mode {
            background: linear-gradient(to bottom, 
                #0ea5e9 0%,
                #38bdf8 25%,
                #7dd3fc 55%,
                #bae6fd 100%) !important;
        }
        
        .day-mode .bg-pattern {
            background-image: none !important;
        }
        
        /* Sunset theme (5pm - 8pm) */
        .sunset-mode {
            background: linear-gradient(to bottom, 
                #60a5fa 0%,
                #a78bfa 25%, 
                #fb7185 50%, 
                #f97316 75%,
                #b91c1c 100%) !important;
        }
        
        .sunset-mode .bg-pattern {
            background-image: none !important;
        }
        
        /* Night theme (8pm - 6am) */
        .night-mode {
            background: linear-gradient(to bottom, #020617 0%, #0f172a 40%, #1e293b 70%, #0f172a 100%) !important;
        }
        
        .night-mode .bg-pattern {
            background-image: none !important;
        }
        
        /* Sun element for day modes */
        .sun {
            position: fixed;
            width: 120px;
            height: 120px;
            background: radial-gradient(circle at 50% 50%, #fef9c3 0%, #fde047 50%, #facc15 100%);
            border-radius: 50%;
            box-shadow: 
                0 0 60px rgba(250, 204, 21, 0.6),
                0 0 120px rgba(250, 204, 21, 0.3);
            z-index: 0;
            pointer-events: none;
            transition: all 2s ease;
        }
        
        .sunrise-mode .sun {
            top: -40px;
            right: -40px;
        }
        
        .day-mode .sun {
            top: -30px;
            right: -30px;
        }
        
        .sunset-mode .sun {
            top: -20px;
            right: -50px;
            background: radial-gradient(circle at 50% 50%, #fef9c3 0%, #fb923c 50%, #dc2626 100%);
            box-shadow: 
                0 0 80px rgba(251, 146, 60, 0.7),
                0 0 150px rgba(220, 38, 38, 0.4);
        }
        
        /* Clouds for day mode - float on right side, away from logo */
        .cloud {
            position: fixed;
            background: white;
            border-radius: 50px;
            opacity: 0.7;
            z-index: 0;
            pointer-events: none;
            animation: floatCloud 80s linear infinite;
        }
        
        .cloud::before,
        .cloud::after {
            content: '';
            position: absolute;
            background: white;
            border-radius: 50%;
        }
        
        .cloud-1 {
            width: 100px;
            height: 40px;
            top: 25%;
            right: -150px;
            left: auto;
            animation-name: floatCloudRight;
        }
        
        .cloud-1::before {
            width: 50px;
            height: 50px;
            top: -25px;
            left: 15px;
        }
        
        .cloud-1::after {
            width: 35px;
            height: 35px;
            top: -15px;
            left: 50px;
        }
        
        .cloud-2 {
            width: 80px;
            height: 30px;
            top: 40%;
            right: -120px;
            left: auto;
            animation-name: floatCloudRight;
            animation-delay: -30s;
            animation-duration: 90s;
        }
        
        .cloud-2::before {
            width: 40px;
            height: 40px;
            top: -20px;
            left: 10px;
        }
        
        .cloud-2::after {
            width: 30px;
            height: 30px;
            top: -12px;
            left: 40px;
        }
        
        @keyframes floatCloud {
            from { transform: translateX(0); }
            to { transform: translateX(calc(100vw + 200px)); }
        }
        
        @keyframes floatCloudRight {
            from { transform: translateX(0); }
            to { transform: translateX(calc(-100vw - 200px)); }
        }
        
        /* Greenhouse WiFi pulse animation - visible filled ripple */
        @keyframes wifiRipple {
            0% {
                transform: scale(1);
                opacity: 0.35;
            }
            100% {
                transform: scale(1.12);
                opacity: 0;
            }
        }
        
        .greenhouse-pulse {
            position: relative;
        }
        
        .greenhouse-pulse::before,
        .greenhouse-pulse::after {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 1.5rem;
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.4), rgba(16, 185, 129, 0.3));
            z-index: -1;
            animation: wifiRipple 3s ease-out infinite;
        }
        
        .greenhouse-pulse::after {
            animation-delay: 1.5s;
        }
        
        /* ===== SETUP WIZARD - GARDEN THEMED ===== */
        
        /* App-like feel - prevents zoom/selection on mobile */
        .setup-wizard {
            touch-action: manipulation;
            user-select: none;
            -webkit-user-select: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            width: 100vw;
            height: 100vh;
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 50%, #bbf7d0 100%);
            overflow: hidden;
        }
        
        .setup-wizard::before {
            content: '';
            position: absolute;
            inset: 0;
            background: 
                radial-gradient(circle at 20% 80%, rgba(134, 239, 172, 0.4) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(74, 222, 128, 0.3) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }
        
        /* Breathing seed animation */
        @keyframes seedBreathe {
            0%, 100% { 
                transform: scale(1);
                filter: drop-shadow(0 0 20px rgba(34, 197, 94, 0.3));
            }
            50% { 
                transform: scale(1.05);
                filter: drop-shadow(0 0 40px rgba(34, 197, 94, 0.5));
            }
        }
        
        .seed-breathing {
            animation: seedBreathe 3s ease-in-out infinite;
        }
        
        /* Germination water fill animation */
        @keyframes waterFill {
            0% { height: 0%; }
            100% { height: 100%; }
        }
        
        .germinating .water-level {
            animation: waterFill 4s ease-out forwards;
        }
        
        /* Root growth animation */
        @keyframes rootGrow {
            0% { stroke-dashoffset: 100; }
            100% { stroke-dashoffset: 0; }
        }
        
        .rooting path.root {
            stroke-dasharray: 100;
            animation: rootGrow 2s ease-out forwards;
        }
        
        /* WiFi network bubble */
        .wifi-bubble {
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid rgba(34, 197, 94, 0.2);
            border-radius: 20px;
            padding: 1rem 1.25rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            color: #1f2937 !important; /* Force dark text - gray-800 */
        }
        
        .wifi-bubble span {
            color: #1f2937 !important; /* Ensure SSID text is dark */
        }
        
        .wifi-bubble:hover {
            border-color: rgba(34, 197, 94, 0.5);
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(34, 197, 94, 0.15);
        }
        
        .wifi-bubble.selected {
            border-color: #22C55E;
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.1) 0%, rgba(134, 239, 172, 0.1) 100%);
        }
        
        .wifi-bubble .password-field {
            max-height: 0;
            opacity: 0;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .wifi-bubble.selected .password-field {
            max-height: 100px;
            opacity: 1;
            margin-top: 1rem;
        }
        
        /* Signal strength bars */
        .signal-bars {
            display: flex;
            gap: 2px;
            align-items: flex-end;
            height: 16px;
        }
        
        .signal-bars .bar {
            width: 4px;
            background: #d1d5db;
            border-radius: 1px;
        }
        
        .signal-bars .bar.active {
            background: #22C55E;
        }
        
        .signal-bars .bar:nth-child(1) { height: 4px; }
        .signal-bars .bar:nth-child(2) { height: 8px; }
        .signal-bars .bar:nth-child(3) { height: 12px; }
        .signal-bars .bar:nth-child(4) { height: 16px; }
        
        /* Setup button - garden UI style */
        .setup-btn {
            background: linear-gradient(to right, #22C55E, #4ADE80);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 1rem 2rem;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: all 0.2s ease;
            box-shadow: 0 4px 14px rgba(34, 197, 94, 0.4);
            position: relative;
        }
        
        .setup-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(34, 197, 94, 0.5);
        }
        
        .setup-btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 8px rgba(34, 197, 94, 0.3);
        }
        
        .setup-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        /* Secondary button - garden UI style outline */
        .setup-btn-secondary {
            background: transparent;
            color: #22C55E;
            border: 2px solid #22C55E;
            border-radius: 12px;
            padding: 0.875rem 1.5rem;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .setup-btn-secondary:hover {
            background: rgba(34, 197, 94, 0.1);
            color: #16A34A;
            border-color: #16A34A;
        }
        
        /* Progress steps */
        .setup-progress {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            margin-bottom: 2rem;
        }
        
        .setup-progress .step {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #d1d5db;
            transition: all 0.3s ease;
        }
        
        .setup-progress .step.active {
            background: #22C55E;
            width: 24px;
            border-radius: 4px;
        }
        
        .setup-progress .step.completed {
            background: #86EFAC;
        }
        
        /* Storage drive cards */
        .drive-card {
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid #e5e7eb;
            border-radius: 16px;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .drive-card:hover {
            border-color: #22C55E;
            box-shadow: 0 4px 12px rgba(34, 197, 94, 0.15);
        }
        
        .drive-card.selected {
            border-color: #22C55E;
            background: rgba(34, 197, 94, 0.08);
            box-shadow: 0 4px 16px rgba(34, 197, 94, 0.2);
        }
        
        .drive-card.has-warning.selected {
            border-color: #F59E0B;
            background: rgba(245, 158, 11, 0.08);
            box-shadow: 0 4px 16px rgba(245, 158, 11, 0.2);
        }
        
        /* ===== SETUP UI TRANSITIONS ===== */
        
        /* iOS-style swipe - clean horizontal slide */
        .setup-card {
            background: #ffffff;
            border-radius: 32px;
            border: none;
            box-shadow: 
                0 8px 32px rgba(34, 197, 94, 0.12),
                0 4px 16px rgba(0, 0, 0, 0.06);
            padding: 2.5rem;
            max-width: 420px;
            width: 100%;
            position: relative;
            z-index: 1;
            min-height: 480px;
        }
        
        /* Card container - rounded overflow clip for smooth transitions */
        .setup-card-container {
            position: relative;
            width: 100%;
            max-width: 420px;
            overflow: hidden;
            border-radius: 32px;
        }
        
        /* Direction-aware swipe transitions */
        .swipe-enter {
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        .swipe-leave {
            transition: all 0.25s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            width: 100%;
        }
        
        /* Forward direction: enter from right, leave to left */
        .forward .swipe-enter-start {
            opacity: 0;
            transform: translateX(60px);
        }
        .forward .swipe-enter-end {
            opacity: 1;
            transform: translateX(0);
        }
        .forward .swipe-leave-start {
            opacity: 1;
            transform: translateX(0);
        }
        .forward .swipe-leave-end {
            opacity: 0;
            transform: translateX(-60px);
        }
        
        /* Back direction: enter from left, leave to right */
        .back .swipe-enter-start {
            opacity: 0;
            transform: translateX(-60px);
        }
        .back .swipe-enter-end {
            opacity: 1;
            transform: translateX(0);
        }
        .back .swipe-leave-start {
            opacity: 1;
            transform: translateX(0);
        }
        .back .swipe-leave-end {
            opacity: 0;
            transform: translateX(60px);
        }
        
        /* Bloom - Success/Completion */
        @keyframes bloom {
            0% {
                opacity: 0;
                transform: scale(0.9);
            }
            100% {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        /* Cooper Plant Drop In - drops into pot and thuds */
        @keyframes cooper-plant-drop {
            0% {
                opacity: 0;
                transform: translateY(-80px) scale(0.9);
            }
            70% {
                opacity: 1;
                transform: translateY(0) scaleY(0.85) scaleX(1.1);
            }
            85% {
                transform: translateY(-4px) scaleY(1.02) scaleX(0.98);
            }
            100% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        .animate-plant-drop {
            animation: cooper-plant-drop 0.5s cubic-bezier(0.22, 1, 0.36, 1) forwards;
        }
        
        /* Water splash for Cooper */
        @keyframes water-splash {
            0% {
                transform: scale(0) translateY(0);
                opacity: 1;
            }
            50% {
                transform: scale(1.2) translateY(-10px);
                opacity: 0.8;
            }
            100% {
                transform: scale(0.8) translateY(20px);
                opacity: 0;
            }
        }
        
        /* Animation utility classes */
        .animate-slide-in-right {
            animation: slide-in-right 300ms ease-out forwards;
        }
        
        .animate-slide-out-left {
            animation: slide-out-left 250ms ease-in forwards;
        }
        
        .animate-slide-in-left {
            animation: slide-in-left 300ms ease-out forwards;
        }
        
        .animate-slide-out-right {
            animation: slide-out-right 250ms ease-in forwards;
        }
        
        /* Progress dot pulse */
        @keyframes dot-pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }
        
        .animate-dot-bloom {
            animation: dot-pulse 600ms ease-out;
        }
        
        .animate-bloom {
            animation: bloom 400ms ease-out forwards;
        }
        
        /* Empty pot gentle wobble for wake screen */
        @keyframes pot-settle {
            0% { transform: scale(0.9); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .animate-pot-settle {
            animation: pot-settle 0.4s ease-out forwards;
        }
        
        /* Reduce motion for accessibility */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
        
        /* WiFi scanning - leaves parting loader */
        @keyframes leafPartLeft {
            0%, 100% { transform: rotate(-5deg) translateX(0); }
            50% { transform: rotate(-25deg) translateX(-8px); }
        }
        
        @keyframes leafPartRight {
            0%, 100% { transform: rotate(5deg) translateX(0); }
            50% { transform: rotate(25deg) translateX(8px); }
        }
        
        @keyframes leafPeek {
            0%, 100% { transform: translateY(0) scale(0.9); opacity: 0.7; }
            50% { transform: translateY(-5px) scale(1); opacity: 1; }
        }
        
        .wifi-loader {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem 0;
        }
        
        .wifi-loader .leaves {
            position: relative;
            width: 80px;
            height: 60px;
        }
        
        .wifi-loader .leaf-left {
            position: absolute;
            left: 10px;
            top: 10px;
            width: 25px;
            height: 40px;
            background: linear-gradient(135deg, #22C55E 0%, #4ADE80 100%);
            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
            transform-origin: bottom right;
            animation: leafPartLeft 1.5s ease-in-out infinite;
        }
        
        .wifi-loader .leaf-right {
            position: absolute;
            right: 10px;
            top: 10px;
            width: 25px;
            height: 40px;
            background: linear-gradient(135deg, #4ADE80 0%, #22C55E 100%);
            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
            transform-origin: bottom left;
            animation: leafPartRight 1.5s ease-in-out infinite;
        }
        
        .wifi-loader .peek-dot {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            width: 16px;
            height: 16px;
            background: #86EFAC;
            border-radius: 50%;
            animation: leafPeek 1.5s ease-in-out infinite;
            box-shadow: 0 0 12px rgba(134, 239, 172, 0.6);
        }
        
        .wifi-loader .stem {
            width: 4px;
            height: 20px;
            background: linear-gradient(to bottom, #22C55E, #166534);
            border-radius: 2px;
            margin-top: -5px;
        }

        /* Status messages - garden themed */
        .status-message {
            text-align: center;
            color: #166534;
            font-weight: 600;
            margin-top: 1.5rem;
        }
        
        .status-message.error {
            color: #DC2626;
        }
        
        /* Cooper glow when alive */
        @keyframes cooperAlive {
            0%, 100% { filter: drop-shadow(0 0 20px rgba(34, 197, 94, 0.5)); }
            50% { filter: drop-shadow(0 0 40px rgba(34, 197, 94, 0.8)); }
        }
        
        .cooper-alive {
            animation: cooperAlive 2s ease-in-out infinite;
        }
        
        /* Expanding status card - subtext hidden by default, shows on hover */
        .status-card-expandable .status-subtext {
            max-height: 0;
            opacity: 0;
            overflow: hidden;
            transition: max-height 0.3s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.2s ease, margin 0.3s ease;
            margin-top: 0;
        }
        
        .status-card-expandable:hover .status-subtext {
            max-height: 100px;
            opacity: 1;
            margin-top: 0.5rem;
        }
        
        /* Stars background */
        .stars-container {
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: 0;
            overflow: hidden;
        }
        
        .star {
            position: absolute;
            background: #fef3c7;
            border-radius: 50%;
            animation: twinkle var(--duration) ease-in-out infinite;
            animation-delay: var(--delay);
        }
        
        @keyframes twinkle {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.2); }
        }
        
        /* Moon */
        .moon {
            position: fixed;
            top: -30px;
            right: -30px;
            width: 100px;
            height: 100px;
            background: radial-gradient(circle at 30% 30%, #fef9c3 0%, #fde68a 50%, #fcd34d 100%);
            border-radius: 50%;
            box-shadow: 
                0 0 40px rgba(254, 249, 195, 0.4),
                0 0 80px rgba(254, 249, 195, 0.2),
                inset -10px -10px 20px rgba(251, 191, 36, 0.3);
            z-index: 0;
            pointer-events: none;
        }
        
        /* Moon craters */
        .moon::before {
            content: '';
            position: absolute;
            top: 20%;
            left: 25%;
            width: 15px;
            height: 15px;
            background: rgba(251, 191, 36, 0.3);
            border-radius: 50%;
        }
        
        .moon::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 45%;
            width: 20px;
            height: 20px;
            background: rgba(251, 191, 36, 0.25);
            border-radius: 50%;
        }
        
        /* Shooting star - very rare event */
        .shooting-star {
            position: fixed;
            width: 4px;
            height: 4px;
            background: linear-gradient(to right, #fef3c7, transparent);
            border-radius: 50%;
            opacity: 0;
            z-index: 1;
            pointer-events: none;
        }
        
        .shooting-star.active {
            animation: shoot 2s ease-out forwards;
        }
        
        .shooting-star::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100px;
            height: 2px;
            background: linear-gradient(to left, #fef3c7, transparent);
            transform: translateX(-100%);
        }
        
        @keyframes shoot {
            0% { opacity: 0; transform: translate(0, 0) rotate(-45deg); }
            10% { opacity: 1; }
            100% { opacity: 0; transform: translate(300px, 300px) rotate(-45deg); }
        }
        
        /* Sunrise/Sunset mode component adjustments */
        .sunrise-mode .desktop-sidebar,
        .sunrise-mode .mobile-sidebar,
        .sunset-mode .desktop-sidebar,
        .sunset-mode .mobile-sidebar {
            background: rgba(255, 255, 255, 0.6) !important;
        }
        
        .sunrise-mode main,
        .sunset-mode main {
            background: rgba(255, 255, 255, 0.5) !important;
        }
        
        .sunrise-mode header,
        .sunset-mode header {
            background: rgba(255, 255, 255, 0.35) !important;
        }
        
        /* Sunset text overrides - solid white for better contrast */
        .sunset-mode h1,
        .sunset-mode h2,
        .sunset-mode h3,
        .sunset-mode .text-gray-800,
        .sunset-mode .text-ease-forest {
            color: #ffffff !important;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
        }
        
        .sunset-mode .text-gray-500,
        .sunset-mode .text-gray-400,
        .sunset-mode .text-gray-600 {
            color: rgba(255, 255, 255, 0.9) !important;
        }
        
        .sunset-mode .text-ease-soil {
            color: rgba(255, 255, 255, 0.85) !important;
        }
        
        .sunset-mode label {
            color: #ffffff !important;
        }
        
        /* Night mode component overrides - dark frosted glass panels */
        .night-mode .desktop-sidebar,
        .night-mode .mobile-sidebar {
            background: rgba(15, 23, 42, 0.75) !important;
            border-color: rgba(71, 85, 105, 0.4) !important;
        }
        
        .night-mode main {
            background: rgba(15, 23, 42, 0.65) !important;
            border-color: rgba(71, 85, 105, 0.3) !important;
        }
        
        .night-mode header {
            background: rgba(15, 23, 42, 0.5) !important;
            border-color: rgba(71, 85, 105, 0.25) !important;
        }
        
        .night-mode .mobile-clock {
            background: rgba(30, 41, 59, 0.8) !important;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }
        
        .night-mode .mobile-clock span {
            color: #e2e8f0 !important;
            text-shadow: none;
        }
        
        .night-mode .mobile-clock .bg-gray-200 {
            background: rgba(71, 85, 105, 0.6) !important;
        }
        
        .night-mode h1,
        .night-mode h3,
        .night-mode .text-gray-800 {
            color: #f1f5f9 !important;
        }
        
        .night-mode .text-gray-500,
        .night-mode .text-gray-400 {
            color: #94a3b8 !important;
        }
        
        .night-mode .text-gray-600 {
            color: #cbd5e1 !important;
        }
        
        .night-mode .nav-bubble:not(.bg-gradient-to-r) {
            color: #94a3b8 !important;
        }
        
        .night-mode .nav-bubble:not(.bg-gradient-to-r):hover {
            background: rgba(51, 65, 85, 0.7) !important;
            color: #34d399 !important;
        }
        
        /* Night mode app tiles - keep the vibrant gradients, just add subtle shadow */
        .night-mode .app-tile {
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }
        
        .night-mode .bg-white {
            background: rgba(30, 41, 59, 0.85) !important;
        }
        
        .night-mode .border-gray-100,
        .night-mode .border-gray-200 {
            border-color: rgba(71, 85, 105, 0.4) !important;
        }
        
        .night-mode .bg-gray-50,
        .night-mode .bg-gray-100 {
            background: rgba(51, 65, 85, 0.6) !important;
        }
        
        .night-mode textarea {
            background: rgba(30, 41, 59, 0.9) !important;
            border-color: rgba(71, 85, 105, 0.6) !important;
            color: #e2e8f0 !important;
        }
        
        .night-mode .sidebar-overlay {
            background: rgba(0, 0, 0, 0.6) !important;
        }
        
        .night-mode .mobile-bottom-nav {
            background: rgba(15, 23, 42, 0.95) !important;
            border-color: rgba(71, 85, 105, 0.4) !important;
        }
        
        .night-mode ::-webkit-scrollbar-thumb {
            background: #475569;
        }
        
        .night-mode ::-webkit-scrollbar-thumb:hover {
            background: #64748b;
        }
        
        /* Welcome box night mode - dark theme */
        .night-mode .from-ease-cream {
            background: linear-gradient(to right, rgba(30, 41, 59, 0.9), rgba(15, 23, 42, 0.9)) !important;
            border-color: rgba(52, 211, 153, 0.4) !important;
        }
        
        .night-mode .text-ease-forest {
            color: #4ade80 !important;
        }
        
        .night-mode .text-ease-soil {
            color: #94a3b8 !important;
        }
        
        /* Dark theme night mode for action bar and settings */
        .night-mode .mobile-action-bar > div {
            background: rgba(15, 23, 42, 0.95) !important;
        }
        
        .night-mode .settings-panel {
            background: rgba(15, 23, 42, 0.95) !important;
        }
        
        /* Night mode status cards */
        .night-mode .status-card.bg-white {
            background: rgba(30, 41, 59, 0.85) !important;
        }
        
        .night-mode .status-card h3 {
            color: #94a3b8 !important;
        }
        
        .night-mode .status-card .status-value {
            color: #f1f5f9 !important;
        }
        
        /* Night mode - green status card text should be white/light for contrast */
        .night-mode .bg-gradient-to-br.from-ease-leaf h3,
        .night-mode .bg-gradient-to-br.from-ease-leaf .text-white\/80 {
            color: rgba(255, 255, 255, 0.9) !important;
        }
        
        /* Night mode h2 headers */
        .night-mode h2 {
            color: #f1f5f9 !important;
        }
        
        /* Night mode labels in settings */
        .night-mode label {
            color: #cbd5e1 !important;
        }
        
        /* Night mode select dropdowns */
        .night-mode select option {
            background: #1e293b !important;
            color: #e2e8f0 !important;
        }
        
        /* Night mode number inputs */
        .night-mode input[type="number"] {
            background: rgba(30, 41, 59, 0.9) !important;
            border-color: rgba(71, 85, 105, 0.6) !important;
            color: #e2e8f0 !important;
        }
        
        /* Night mode checkboxes */
        .night-mode input[type="checkbox"] {
            background: rgba(51, 65, 85, 0.8) !important;
        }
        
        /* Night mode details/summary */
        .night-mode details summary {
            color: #f1f5f9 !important;
        }
        
        .night-mode details summary p {
            color: #94a3b8 !important;
        }
        
        /* Night mode card backgrounds in settings */
        .night-mode .bg-white\/70 {
            background: rgba(30, 41, 59, 0.85) !important;
        }
        
        /* Night mode icon backgrounds in settings */
        .night-mode .bg-ease-leaf\/10,
        .night-mode .bg-blue-500\/10,
        .night-mode .bg-purple-500\/10,
        .night-mode .bg-gray-500\/10 {
            background: rgba(51, 65, 85, 0.6) !important;
        }
        
        /* Night mode inputs and form elements */
        .night-mode input[type="text"],
        .night-mode input[type="password"],
        .night-mode input[type="email"],
        .night-mode select {
            background: rgba(30, 41, 59, 0.9) !important;
            border-color: rgba(71, 85, 105, 0.6) !important;
            color: #e2e8f0 !important;
        }
        
        .night-mode input::placeholder,
        .night-mode textarea::placeholder {
            color: #64748b !important;
        }
        
        /* Theme toggle button */
        .theme-toggle {
            transition: all 0.3s ease;
        }
        
        .theme-toggle:hover {
            transform: rotate(15deg) scale(1.1);
        }
        
        .btn-press:active {
            transform: translateY(4px);
            box-shadow: 0 2px 0 #166534;
        }
        
        .nav-bubble {
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        
        .nav-bubble:hover {
            transform: scale(1.05);
        }
        
        .app-tile {
            transition: all 0.2s ease-out;
        }
        
        .app-tile:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.12);
        }
        
        .slide-up {
            animation: slideUp 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .pending-pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(234, 88, 12, 0.4); }
            50% { box-shadow: 0 0 0 15px rgba(234, 88, 12, 0); }
        }
        
        /* Custom scrollbar - Desktop */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: rgba(0, 0, 0, 0.05); border-radius: 10px; }
        ::-webkit-scrollbar-thumb { background: #86EFAC; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #22C55E; }
        
        /* Firefox scrollbar */
        * {
            scrollbar-width: thin;
            scrollbar-color: #86EFAC transparent;
        }
        
        /* Mobile scrollbar - force visible on touch devices */
        .wifi-network-list,
        .setup-card-container,
        .overflow-y-auto {
            -webkit-overflow-scrolling: touch;
            scrollbar-width: thin;
            scrollbar-color: #86EFAC rgba(0, 0, 0, 0.05);
        }
        
        .wifi-network-list::-webkit-scrollbar,
        .setup-card-container::-webkit-scrollbar {
            width: 6px;
            display: block !important;
        }
        
        .wifi-network-list::-webkit-scrollbar-track,
        .setup-card-container::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.05);
            border-radius: 10px;
        }
        
        .wifi-network-list::-webkit-scrollbar-thumb,
        .setup-card-container::-webkit-scrollbar-thumb {
            background: #86EFAC;
            border-radius: 10px;
            min-height: 40px;
        }
        
        /* Plant pot logo animation */
        .plant-sway {
            animation: sway 3s ease-in-out infinite;
            transform-origin: bottom center;
        }
        
        @keyframes sway {
            0%, 100% { transform: rotate(-2deg); }
            50% { transform: rotate(2deg); }
        }
        
        /* Cute blink animation */
        .chibi-eye {
            animation: blink 4s infinite;
        }
        
        @keyframes blink {
            0%, 90%, 100% { transform: scaleY(1); }
            95% { transform: scaleY(0.1); }
        }
        
        /* Watering can cursor - only for the cactus */
        .cursor-watering-can {
            cursor: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='32' height='32' viewBox='0 0 32 32'%3E%3C!-- Watering can body --%3E%3Cpath d='M8 14 L8 24 Q8 26 10 26 L22 26 Q24 26 24 24 L24 14 Q24 12 22 12 L10 12 Q8 12 8 14 Z' fill='%2393C5FD'/%3E%3C!-- Handle --%3E%3Cpath d='M22 14 Q28 14 28 20 Q28 22 26 22 L24 22' stroke='%233B82F6' stroke-width='3' fill='none' stroke-linecap='round'/%3E%3C!-- Spout --%3E%3Cpath d='M8 16 L2 12 L2 10 L4 10 L8 14' fill='%233B82F6'/%3E%3C!-- Water drops --%3E%3Ccircle cx='2' cy='14' r='1.5' fill='%2360A5FA'/%3E%3Ccircle cx='4' cy='17' r='1.5' fill='%2360A5FA'/%3E%3Ccircle cx='1' cy='18' r='1' fill='%2393C5FD'/%3E%3C!-- Highlight --%3E%3Cpath d='M12 14 L12 18' stroke='white' stroke-width='1.5' stroke-linecap='round' opacity='0.6'/%3E%3C/svg%3E") 2 14, pointer;
        }
        
        /* Water droplets animation */
        .water-drops {
            position: absolute;
            pointer-events: none;
        }
        
        .water-drop {
            position: absolute;
            width: 6px;
            height: 8px;
            background: linear-gradient(to bottom, #93C5FD, #3B82F6);
            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
            animation: dropFall 0.6s ease-in forwards;
            opacity: 0;
        }
        
        @keyframes dropFall {
            0% { opacity: 1; transform: translateY(0) scale(1); }
            100% { opacity: 0; transform: translateY(30px) scale(0.5); }
        }
        
        /* Happy plant animation */
        .plant-happy {
            animation: happyBounce 0.5s ease-out;
        }
        
        @keyframes happyBounce {
            0%, 100% { transform: rotate(-2deg) scale(1); }
            25% { transform: rotate(5deg) scale(1.1); }
            50% { transform: rotate(-5deg) scale(1.15); }
            75% { transform: rotate(3deg) scale(1.1); }
        }
        
        /* Super happy eyes (closed happy) */
        .eyes-super-happy .chibi-eye ellipse {
            animation: none !important;
        }
        
        .eyes-super-happy .chibi-eye {
            animation: none !important;
        }
        
        /* ===== RESPONSIVE & MOBILE STYLES ===== */
        
        /* Smooth resize transitions */
        .resize-transition {
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        
        /* Mobile sidebar overlay */
        .sidebar-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(4px);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 40;
        }
        
        .sidebar-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        /* Mobile sidebar slide-in */
        .mobile-sidebar {
            position: fixed;
            left: 0;
            top: 0;
            bottom: 0;
            width: 280px;
            max-width: 85vw;
            transform: translateX(-100%);
            transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            z-index: 50;
        }
        
        .mobile-sidebar.open {
            transform: translateX(0);
        }
        
        /* Desktop sidebar - visible by default, hidden at 900px */
        .desktop-sidebar {
            display: flex;
        }
        
        /* Hamburger menu button */
        .menu-btn {
            display: none;
        }
        
        /* Mobile bottom nav - YouTube-style unified bar */
        .mobile-bottom-nav {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-top: 1px solid rgba(0, 0, 0, 0.08);
            z-index: 50;
            padding-bottom: env(safe-area-inset-bottom, 0);
        }
        
        .mobile-bottom-nav .nav-container {
            display: flex;
            justify-content: space-around;
            align-items: center;
            height: 56px;
            max-width: 400px;
            margin: 0 auto;
        }
        
        .mobile-bottom-nav .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            flex: 1;
            padding: 8px 0;
            cursor: pointer;
            transition: all 0.2s ease;
            border-radius: 12px;
            margin: 4px;
        }
        
        .mobile-bottom-nav .nav-item:active {
            transform: scale(0.95);
            background: rgba(34, 197, 94, 0.1);
        }
        
        .mobile-bottom-nav .nav-item svg {
            width: 24px;
            height: 24px;
            margin-bottom: 2px;
        }
        
        .mobile-bottom-nav .nav-item span {
            font-size: 10px;
            font-weight: 600;
            letter-spacing: 0.02em;
        }
        
        .mobile-bottom-nav .nav-item.active {
            color: #22C55E;
        }
        
        .mobile-bottom-nav .nav-item.inactive {
            color: #9CA3AF;
        }

        /* Touch feedback */
        .touch-feedback {
            -webkit-tap-highlight-color: transparent;
        }
        
        .touch-feedback:active {
            transform: scale(0.97);
            opacity: 0.9;
        }
        
        /* Responsive breakpoints */
        
        /* Large tablets in landscape (1024px and below) */
        @media (max-width: 1024px) {
            .app-tile:hover {
                transform: none;
            }
            
            .nav-bubble:hover {
                transform: none;
            }
            
            /* Reduce sidebar width on tablets */
            .desktop-sidebar {
                width: 220px !important;
                min-width: 220px !important;
                padding: 1.25rem !important;
            }
            
            .desktop-sidebar .nav-bubble {
                padding: 0.75rem 1rem !important;
                font-size: 0.9rem !important;
            }
            
            .desktop-sidebar .nav-bubble svg {
                width: 1.25rem !important;
                height: 1.25rem !important;
            }
            
            /* Adjust status cards */
            .status-card {
                padding: 1rem !important;
            }
            
            .status-card h3 {
                font-size: 0.7rem !important;
            }
            
            .status-card .status-value {
                font-size: 1.5rem !important;
            }
        }
        
        /* Small tablets in portrait and large phones (900px and below) */
        @media (max-width: 900px) {
            .menu-btn {
                display: flex;
            }
            
            .desktop-sidebar {
                display: none !important;
            }
            
            .mobile-bottom-nav {
                display: block !important;
            }
            
            /* Full width main content with bottom padding for nav */
            main {
                margin-left: 0 !important;
                padding-bottom: calc(56px + env(safe-area-inset-bottom, 0)) !important;
            }
            
            /* Compact status cards for mobile */
            .status-grid {
                display: flex !important;
                flex-direction: row !important;
                gap: 0.5rem !important;
                flex-wrap: nowrap !important;
            }
            
            .status-card {
                flex: 1 !important;
                min-width: 0 !important;
                padding: 0.75rem 0.5rem !important;
                min-height: auto !important;
            }
            
            .status-card h3 {
                font-size: 0.6rem !important;
            }
            
            .status-card .status-value {
                font-size: 1.1rem !important;
            }
        }
        
        /* Tablets in portrait (768px and below) */
        @media (max-width: 768px) {
            /* Adjust main content padding for mobile */
            .mobile-content-padding {
                padding: 1rem !important;
            }
            
            /* Stack cards vertically on mobile */
            .mobile-stack {
                grid-template-columns: 1fr !important;
            }
            
            /* Floating action bar mobile adjustments */
            .mobile-action-bar {
                padding: 0.75rem !important;
            }
            
            .mobile-action-bar > div {
                flex-direction: column;
                gap: 1rem;
            }
            
            .mobile-action-bar .action-buttons {
                width: 100%;
                justify-content: stretch;
            }
            
            .mobile-action-bar .action-buttons button {
                flex: 1;
            }
            
            /* Better header sizing */
            .mobile-header h1 {
                font-size: 1.5rem !important;
            }
            
            /* Status cards in row */
            .status-grid {
                display: flex !important;
                flex-direction: row !important;
                gap: 0.75rem !important;
            }
            
            .status-card {
                flex: 1 !important;
                min-width: 0 !important;
                padding: 0.875rem !important;
            }
            
            .status-card h3 {
                font-size: 0.6rem !important;
                letter-spacing: 0.03em !important;
            }
            
            .status-card .status-value {
                font-size: 1.25rem !important;
            }
            
            /* App tiles grid */
            .app-grid {
                grid-template-columns: repeat(2, 1fr) !important;
                gap: 0.75rem !important;
            }
            
            .app-tile {
                padding: 1rem !important;
            }
            
            .app-tile h3 {
                font-size: 0.875rem !important;
            }
            
            .app-tile p {
                font-size: 0.7rem !important;
                display: -webkit-box;
                -webkit-line-clamp: 2;
                line-clamp: 2;
                -webkit-box-orient: vertical;
                overflow: hidden;
            }
            
            /* Mobile sidebar adjustments */
            .mobile-sidebar {
                width: 300px !important;
                max-width: 80vw !important;
            }
            
            .mobile-sidebar .nav-bubble {
                padding: 1rem 1.25rem !important;
                font-size: 1rem !important;
            }
            
            /* Garden scene mobile adjustments */
            .garden-row {
                gap: 20px !important;
            }
            
            .garden-plant .sprout {
                width: 50px !important;
                height: 70px !important;
            }
            
            .garden-message h2 {
                font-size: 1.75rem !important;
            }
            
            .garden-message p {
                font-size: 1rem !important;
            }
        }
        
        /* Small phones (480px and below) */
        @media (max-width: 480px) {
            .mobile-header {
                padding-left: 0.75rem !important;
                padding-right: 0.75rem !important;
            }
            
            .mobile-header h1 {
                font-size: 1.25rem !important;
            }
            
            .mobile-clock {
                display: none;
            }
            
            /* Smaller status cards */
            .status-card {
                padding: 0.75rem !important;
            }
            
            .status-card h3 {
                font-size: 0.55rem !important;
            }
            
            .status-card .status-value {
                font-size: 1.1rem !important;
            }
            
            /* App tiles single column on very small screens */
            .app-grid {
                grid-template-columns: 1fr !important;
            }
            
            .app-tile {
                padding: 0.875rem !important;
            }
            
            /* Mobile bottom nav smaller */
            .mobile-bottom-nav {
                padding: 0.5rem !important;
            }
            
            .mobile-bottom-nav button {
                padding: 0.5rem !important;
            }
            
            .mobile-bottom-nav span {
                font-size: 0.65rem !important;
            }
            
            /* Garden scene adjustments for small screens */
            .garden-row {
                gap: 12px !important;
            }
            
            .garden-plant .sprout {
                width: 40px !important;
                height: 55px !important;
            }
            
            .garden-message {
                top: 20% !important;
            }
            
            .garden-message h2 {
                font-size: 1.5rem !important;
            }
            
            .garden-message p {
                font-size: 0.875rem !important;
            }
            
            /* Transition clouds smaller */
            .cloud-wipe-1 {
                width: 200px;
                height: 80px;
            }
            
            .cloud-wipe-2 {
                width: 250px;
                height: 100px;
            }
            
            .cloud-wipe-3 {
                width: 220px;
                height: 90px;
            }
        }
        
        /* Extra small phones (360px and below) */
        @media (max-width: 360px) {
            .mobile-header h1 {
                font-size: 1.1rem !important;
            }
            
            .mobile-sidebar {
                width: 260px !important;
            }
            
            .status-grid {
                flex-direction: column !important;
            }
            
            .garden-plant .sprout {
                width: 35px !important;
                height: 50px !important;
            }
        }
        
        /* Safe area insets for notched devices */
        @supports (padding: max(0px)) {
            .safe-bottom {
                padding-bottom: max(1.5rem, env(safe-area-inset-bottom));
            }
            
            .safe-top {
                padding-top: max(1.25rem, env(safe-area-inset-top));
            }
        }
        
        /* Orientation change animation */
        @media (orientation: portrait) {
            .orientation-animate {
                animation: orientationChange 0.3s ease;
            }
        }
        
        @keyframes orientationChange {
            from { opacity: 0.8; transform: scale(0.98); }
            to { opacity: 1; transform: scale(1); }
        }
        
        /* Prevent text selection on touch */
        .no-select {
            -webkit-user-select: none;
            user-select: none;
        }
        
        /* ===== GARDEN SCENE ANIMATION ===== */
        .garden-scene {
            position: fixed;
            inset: 0;
            background: linear-gradient(to bottom, 
                #7dd3fc 0%,
                #bae6fd 40%,
                #86efac 40%,
                #22c55e 60%,
                #166534 100%);
            z-index: 9999;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            align-items: center;
            padding-bottom: 15%;
            overflow: hidden;
        }
        
        .garden-scene.night-garden {
            background: linear-gradient(to bottom, 
                #0f172a 0%,
                #1e293b 40%,
                #064e3b 40%,
                #065f46 60%,
                #022c22 100%);
        }
        
        .garden-scene.sunrise-garden {
            background: linear-gradient(to bottom, 
                #fef3c7 0%,
                #fed7aa 40%,
                #86efac 40%,
                #22c55e 60%,
                #166534 100%);
        }
        
        .garden-scene.sunset-garden {
            background: linear-gradient(to bottom, 
                #fda4af 0%,
                #fb923c 40%,
                #86efac 40%,
                #22c55e 60%,
                #166534 100%);
        }
        

    </style>
</head>
<body class="font-nunito bg-gradient-to-br from-ease-cream to-white bg-pattern min-h-screen overflow-hidden transition-all duration-500" 
      x-data="easeOS()" 
      x-init="init()"
      :class="timeOfDayClass"
      @resize.window="handleResize()">

    <!-- Day Sky Elements (sun and clouds) -->
    <div x-show="timeOfDay === 'sunrise' || timeOfDay === 'day' || timeOfDay === 'sunset'" x-cloak class="sun"></div>
    <div x-show="timeOfDay === 'day'" x-cloak class="cloud cloud-1"></div>
    <div x-show="timeOfDay === 'day'" x-cloak class="cloud cloud-2"></div>
    
    <!-- Night Sky Elements -->
    <div x-show="timeOfDay === 'night'" x-cloak class="stars-container" x-ref="starsContainer"></div>
    <div x-show="timeOfDay === 'night'" x-cloak class="moon"></div>
    <div x-show="timeOfDay === 'night'" x-cloak class="shooting-star" x-ref="shootingStar" style="top: 15%; left: 20%;"></div>
    

    
    <!-- Mobile Sidebar Overlay -->
    <div class="sidebar-overlay" 
         :class="{ 'active': sidebarOpen }" 
         @click="sidebarOpen = false"></div>
    
    <!-- Mobile Sidebar -->
    <aside class="mobile-sidebar bg-white/50 backdrop-blur-2xl p-6 flex flex-col shadow-2xl border-r border-white/30 safe-top"
           :class="{ 'open': sidebarOpen }">
        <!-- Same content as desktop sidebar -->
        <div class="flex items-center justify-center gap-3 mb-8 px-2">
            <div class="w-12 h-12 relative cursor-watering-can"
                 :class="{ 'plant-happy': isHappy, 'plant-sway': !isHappy }"
                 @touchstart="startWatering('mobile')"
                 @touchend="stopWatering()">
                <div class="water-drops" x-ref="mobileWaterDrops"></div>
                <!-- Haworthia Cooperi - translucent rosette succulent -->
                <svg viewBox="0 0 100 100" class="w-full h-full" :class="{ 'eyes-super-happy': isHappy }">
                    <!-- Terracotta pot -->
                    <path d="M30 75 L35 92 L65 92 L70 75 Z" fill="#EA580C"/>
                    <path d="M25 70 L75 70 L75 77 L25 77 Z" fill="#C2410C" rx="3"/>
                    <ellipse cx="50" cy="73" rx="25" ry="3" fill="#EA580C"/>
                    <!-- Soil -->
                    <ellipse cx="50" cy="71" rx="20" ry="4" fill="#365314"/>
                    
                    <!-- Haworthia leaves - rosette pattern with translucent tips -->
                    <!-- Back leaves -->
                    <ellipse cx="35" cy="50" rx="8" ry="18" fill="#4ADE80" transform="rotate(-35 35 50)"/>
                    <ellipse cx="35" cy="48" rx="5" ry="8" fill="#86EFAC" opacity="0.7" transform="rotate(-35 35 48)"/>
                    <ellipse cx="65" cy="50" rx="8" ry="18" fill="#4ADE80" transform="rotate(35 65 50)"/>
                    <ellipse cx="65" cy="48" rx="5" ry="8" fill="#86EFAC" opacity="0.7" transform="rotate(35 65 48)"/>
                    
                    <!-- Middle leaves -->
                    <ellipse cx="28" cy="58" rx="7" ry="15" fill="#22C55E" transform="rotate(-55 28 58)"/>
                    <ellipse cx="28" cy="55" rx="4" ry="7" fill="#A7F3D0" opacity="0.8" transform="rotate(-55 28 55)"/>
                    <ellipse cx="72" cy="58" rx="7" ry="15" fill="#22C55E" transform="rotate(55 72 58)"/>
                    <ellipse cx="72" cy="55" rx="4" ry="7" fill="#A7F3D0" opacity="0.8" transform="rotate(55 72 55)"/>
                    
                    <!-- Front center leaves -->
                    <ellipse cx="42" cy="55" rx="9" ry="20" fill="#22C55E" transform="rotate(-15 42 55)"/>
                    <ellipse cx="42" cy="50" rx="5" ry="10" fill="#A7F3D0" opacity="0.8" transform="rotate(-15 42 50)"/>
                    <ellipse cx="58" cy="55" rx="9" ry="20" fill="#22C55E" transform="rotate(15 58 55)"/>
                    <ellipse cx="58" cy="50" rx="5" ry="10" fill="#A7F3D0" opacity="0.8" transform="rotate(15 58 50)"/>
                    
                    <!-- Center leaf -->
                    <ellipse cx="50" cy="52" rx="8" ry="22" fill="#16A34A"/>
                    <ellipse cx="50" cy="45" rx="5" ry="12" fill="#BBF7D0" opacity="0.85"/>
                    
                    <!-- Cute chibi face in center -->
                    <g class="chibi-eye" style="transform-origin: 50px 52px;" x-show="!isHappy">
                        <ellipse cx="45" cy="52" rx="3" ry="4" fill="#1a1a1a"/>
                        <ellipse cx="55" cy="52" rx="3" ry="4" fill="#1a1a1a"/>
                        <circle cx="46" cy="50" r="1.2" fill="white"/>
                        <circle cx="56" cy="50" r="1.2" fill="white"/>
                    </g>
                    <g x-show="isHappy" x-cloak>
                        <path d="M42 52 Q45 48 48 52" stroke="#1a1a1a" stroke-width="2" fill="none" stroke-linecap="round"/>
                        <path d="M52 52 Q55 48 58 52" stroke="#1a1a1a" stroke-width="2" fill="none" stroke-linecap="round"/>
                    </g>
                    <ellipse cx="40" cy="56" :rx="isHappy ? 3 : 2.5" :ry="isHappy ? 2 : 1.5" fill="#FDA4AF" :opacity="isHappy ? 0.9 : 0.7"/>
                    <ellipse cx="60" cy="56" :rx="isHappy ? 3 : 2.5" :ry="isHappy ? 2 : 1.5" fill="#FDA4AF" :opacity="isHappy ? 0.9 : 0.7"/>
                    <path :d="isHappy ? 'M46 58 Q50 64 54 58' : 'M47 58 Q50 62 53 58'" stroke="#1a1a1a" stroke-width="1.5" fill="none" stroke-linecap="round"/>
                </svg>
            </div>
            <div>
                <span class="text-xl font-extrabold text-ease-forest drop-shadow-sm">ease</span>
                <span class="text-xl font-extrabold text-ease-leaf drop-shadow-sm">OS</span>
            </div>
            <button @click="sidebarOpen = false" class="ml-auto p-2 rounded-xl hover:bg-gray-100 transition-colors">
                <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
            </button>
        </div>
        
        <nav class="flex-1 space-y-2">
            <template x-for="item in navItems" :key="item.id">
                <button @click="currentView = item.id; sidebarOpen = false"
                        class="touch-feedback w-full flex items-center gap-4 px-4 py-3 rounded-xl font-bold text-base transition-all"
                        :class="currentView === item.id 
                            ? 'bg-gradient-to-r from-ease-leaf to-ease-sage text-white shadow-soft' 
                            : 'text-gray-500 hover:bg-ease-cream hover:text-ease-forest'">
                    <span x-html="item.icon"></span>
                    <span x-text="item.label"></span>
                </button>
            </template>
        </nav>
        
        <div class="mt-auto pt-4 border-t border-gray-100">
            <div class="flex items-center gap-3 px-3">
                <div class="w-3 h-3 rounded-full" 
                     :class="greenhouseMode ? 'bg-amber-500 animate-pulse' : (systemStatus === 'active' ? 'bg-ease-terracotta animate-pulse' : 'bg-ease-leaf')"></div>
                <span class="text-sm font-semibold text-gray-500" x-text="greenhouseMode ? 'Greenhouse' : (systemStatus === 'active' ? 'Growing...' : 'Thriving')"></span>
            </div>
        </div>
    </aside>
    
    <div class="flex h-screen p-3 md:p-5 gap-3 md:gap-5 resize-transition orientation-animate">
        
        <!-- Desktop Sidebar - CSS controls visibility at 900px breakpoint -->
        <aside class="desktop-sidebar w-64 bg-white/50 backdrop-blur-2xl rounded-[2rem] p-6 flex flex-col shadow-card border border-white/30 resize-transition">
            
            <!-- Logo -->
            <div class="flex items-center justify-center gap-3 mb-10 px-2">
                <div class="w-14 h-14 relative cursor-watering-can"
                     :class="{ 'plant-happy': isHappy, 'plant-sway': !isHappy }"
                     @mousedown="startWatering('main')"
                     @mouseup="stopWatering()"
                     @mouseleave="stopWatering()"
                     @touchstart.prevent="startWatering('main')"
                     @touchend="stopWatering()">
                    <!-- Water drops container -->
                    <div class="water-drops" x-ref="waterDrops"></div>
                    <!-- Haworthia Cooperi - translucent rosette succulent -->
                    <svg viewBox="0 0 100 100" class="w-full h-full" :class="{ 'eyes-super-happy': isHappy }">
                        <!-- Terracotta pot -->
                        <path d="M30 75 L35 92 L65 92 L70 75 Z" fill="#EA580C"/>
                        <path d="M25 70 L75 70 L75 77 L25 77 Z" fill="#C2410C" rx="3"/>
                        <ellipse cx="50" cy="73" rx="25" ry="3" fill="#EA580C"/>
                        
                        <!-- Soil -->
                        <ellipse cx="50" cy="71" rx="20" ry="4" fill="#365314"/>
                        
                        <!-- Haworthia leaves - rosette pattern with translucent tips -->
                        <!-- Back leaves -->
                        <ellipse cx="35" cy="50" rx="8" ry="18" fill="#4ADE80" transform="rotate(-35 35 50)"/>
                        <ellipse cx="35" cy="48" rx="5" ry="8" fill="#86EFAC" opacity="0.7" transform="rotate(-35 35 48)"/>
                        <ellipse cx="65" cy="50" rx="8" ry="18" fill="#4ADE80" transform="rotate(35 65 50)"/>
                        <ellipse cx="65" cy="48" rx="5" ry="8" fill="#86EFAC" opacity="0.7" transform="rotate(35 65 48)"/>
                        
                        <!-- Middle leaves -->
                        <ellipse cx="28" cy="58" rx="7" ry="15" fill="#22C55E" transform="rotate(-55 28 58)"/>
                        <ellipse cx="28" cy="55" rx="4" ry="7" fill="#A7F3D0" opacity="0.8" transform="rotate(-55 28 55)"/>
                        <ellipse cx="72" cy="58" rx="7" ry="15" fill="#22C55E" transform="rotate(55 72 58)"/>
                        <ellipse cx="72" cy="55" rx="4" ry="7" fill="#A7F3D0" opacity="0.8" transform="rotate(55 72 55)"/>
                        
                        <!-- Front center leaves -->
                        <ellipse cx="42" cy="55" rx="9" ry="20" fill="#22C55E" transform="rotate(-15 42 55)"/>
                        <ellipse cx="42" cy="50" rx="5" ry="10" fill="#A7F3D0" opacity="0.8" transform="rotate(-15 42 50)"/>
                        <ellipse cx="58" cy="55" rx="9" ry="20" fill="#22C55E" transform="rotate(15 58 55)"/>
                        <ellipse cx="58" cy="50" rx="5" ry="10" fill="#A7F3D0" opacity="0.8" transform="rotate(15 58 50)"/>
                        
                        <!-- Center leaf -->
                        <ellipse cx="50" cy="52" rx="8" ry="22" fill="#16A34A"/>
                        <ellipse cx="50" cy="45" rx="5" ry="12" fill="#BBF7D0" opacity="0.85"/>
                        
                        <!-- Cute chibi face in center -->
                        <!-- Big sparkly eyes - normal state -->
                        <g class="chibi-eye" style="transform-origin: 50px 52px;" x-show="!isHappy">
                            <ellipse cx="45" cy="52" rx="3" ry="4" fill="#1a1a1a"/>
                            <ellipse cx="55" cy="52" rx="3" ry="4" fill="#1a1a1a"/>
                            <!-- Eye sparkles -->
                            <circle cx="46" cy="50" r="1.2" fill="white"/>
                            <circle cx="56" cy="50" r="1.2" fill="white"/>
                            <circle cx="44" cy="53" r="0.6" fill="white"/>
                            <circle cx="54" cy="53" r="0.6" fill="white"/>
                        </g>
                        <!-- Super happy closed eyes (^^) -->
                        <g x-show="isHappy" x-cloak>
                            <path d="M42 52 Q45 48 48 52" stroke="#1a1a1a" stroke-width="2" fill="none" stroke-linecap="round"/>
                            <path d="M52 52 Q55 48 58 52" stroke="#1a1a1a" stroke-width="2" fill="none" stroke-linecap="round"/>
                        </g>
                        <!-- Rosy cheeks - bigger when happy -->
                        <ellipse cx="40" cy="56" :rx="isHappy ? 3 : 2.5" :ry="isHappy ? 2 : 1.5" fill="#FDA4AF" :opacity="isHappy ? 0.9 : 0.7"/>
                        <ellipse cx="60" cy="56" :rx="isHappy ? 3 : 2.5" :ry="isHappy ? 2 : 1.5" fill="#FDA4AF" :opacity="isHappy ? 0.9 : 0.7"/>
                        <!-- Happy little smile - bigger when super happy -->
                        <path :d="isHappy ? 'M46 58 Q50 64 54 58' : 'M47 58 Q50 62 53 58'" stroke="#1a1a1a" stroke-width="1.5" fill="none" stroke-linecap="round"/>
                    </svg>
                </div>
                <div>
                    <span class="text-2xl font-extrabold text-ease-forest drop-shadow-sm">ease</span>
                    <span class="text-2xl font-extrabold text-ease-leaf drop-shadow-sm">OS</span>
                </div>
            </div>
            
            <!-- Navigation -->
            <nav class="flex-1 space-y-3">
                <template x-for="item in navItems" :key="item.id">
                    <button @click="currentView = item.id"
                            class="nav-bubble w-full flex items-center gap-4 px-5 py-4 rounded-2xl font-bold text-lg transition-all"
                            :class="currentView === item.id 
                                ? 'bg-gradient-to-r from-ease-leaf to-ease-sage text-white shadow-soft' 
                                : 'text-gray-500 hover:bg-ease-cream hover:text-ease-forest'">
                        <span x-html="item.icon"></span>
                        <span x-text="item.label"></span>
                    </button>
                </template>
            </nav>
            
            <!-- Status Indicator -->
            <div class="mt-auto pt-6 border-t border-gray-100">
                <div class="flex items-center gap-3 px-3">
                    <div class="w-3 h-3 rounded-full" 
                         :class="greenhouseMode ? 'bg-amber-500 animate-pulse' : (systemStatus === 'active' ? 'bg-ease-terracotta animate-pulse' : 'bg-ease-leaf')"></div>
                    <span class="text-sm font-semibold text-gray-500" x-text="greenhouseMode ? 'Greenhouse' : (systemStatus === 'active' ? 'Growing...' : 'Thriving')"></span>
                </div>
            </div>
        </aside>
        
        <!-- Main Content -->
        <main class="flex-1 bg-white/45 backdrop-blur-2xl rounded-2xl md:rounded-[2rem] shadow-card border border-white/25 flex flex-col overflow-hidden relative mb-16 md:mb-0 resize-transition">
            
            <!-- Top Bar -->
            <header class="mobile-header h-16 md:h-20 px-4 md:px-8 flex items-center justify-between border-b border-white/25 bg-white/30 backdrop-blur-lg">
                <div class="flex items-center gap-3">
                    <!-- Mobile Menu Button -->
                    <button @click="sidebarOpen = true" 
                            class="menu-btn touch-feedback p-2 -ml-2 rounded-xl hover:bg-ease-cream transition-colors">
                        <svg class="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
                        </svg>
                    </button>
                    <h1 class="text-xl md:text-2xl font-extrabold text-gray-800" x-text="navItems.find(n => n.id === currentView)?.label || 'Home'"></h1>
                </div>
                <div class="flex items-center gap-2 md:gap-4">
                    <!-- Theme Toggle -->
                    <button @click="toggleTheme()" 
                            class="theme-toggle p-2 rounded-xl hover:bg-ease-cream/50 transition-colors"
                            :class="{ 'hover:bg-night-cloud/30': isNightMode }">
                        <!-- Sun icon (shown in night mode) -->
                        <svg x-show="isNightMode" class="w-5 h-5 md:w-6 md:h-6 text-amber-300" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zM2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1zm18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zM11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1zm0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1zM5.99 4.58c-.39-.39-1.03-.39-1.41 0-.39.39-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0s.39-1.03 0-1.41L5.99 4.58zm12.37 12.37c-.39-.39-1.03-.39-1.41 0-.39.39-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0 .39-.39.39-1.03 0-1.41l-1.06-1.06zm1.06-10.96c.39-.39.39-1.03 0-1.41-.39-.39-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06zM7.05 18.36c.39-.39.39-1.03 0-1.41-.39-.39-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06z"/>
                        </svg>
                        <!-- Moon icon (shown in day mode) -->
                        <svg x-show="!isNightMode" class="w-5 h-5 md:w-6 md:h-6 text-gray-500" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9 9-4.03 9-9c0-.46-.04-.92-.1-1.36-.98 1.37-2.58 2.26-4.4 2.26-2.98 0-5.4-2.42-5.4-5.4 0-1.81.89-3.42 2.26-4.4-.44-.06-.9-.1-1.36-.1z"/>
                        </svg>
                    </button>
                    <!-- Connection status indicator -->
                    <div x-show="!isConnected" 
                         x-cloak
                         class="flex items-center gap-2 px-3 py-1.5 bg-red-100 text-red-600 rounded-full text-xs font-semibold animate-pulse">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 5.636a9 9 0 010 12.728m-3.536-3.536a4 4 0 010-5.656m-7.072 7.072a9 9 0 010-12.728m3.536 3.536a4 4 0 010 5.656"/>
                        </svg>
                        <span class="hidden sm:inline">Reconnecting...</span>
                    </div>
                    <div class="mobile-clock bg-white rounded-full px-3 md:px-5 py-2 shadow-sm flex items-center gap-2 md:gap-3">
                        <span class="text-gray-500 font-semibold text-sm md:text-base" x-text="clock"></span>
                        <div class="hidden md:block w-px h-4 bg-gray-200"></div>
                        <span class="hidden md:inline text-gray-400 text-sm" x-text="ipAddress"></span>
                    </div>
                </div>
            </header>
            
            <!-- Content Area -->
            <div class="flex-1 overflow-y-auto p-4 md:p-8 mobile-content-padding">
                
                <!-- Home View -->
                <div x-show="currentView === 'home'" x-cloak class="slide-up space-y-4 md:space-y-6">
                    
                    <div class="status-grid grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6 items-start">
                        <div class="status-card status-card-expandable rounded-3xl p-6 text-white shadow-soft"
                             :class="[
                                 greenhouseMode ? 'bg-gradient-to-br from-amber-500 to-emerald-500' : 'bg-gradient-to-br from-ease-leaf to-ease-sage',
                                 greenhouseMode ? 'greenhouse-pulse' : ''
                             ]">
                            <h3 class="text-sm font-semibold opacity-80 mb-1">STATUS</h3>
                            <div class="status-value text-3xl font-extrabold" x-text="greenhouseMode ? 'Greenhouse' : (systemStatus === 'active' ? 'Growing' : 'Thriving')"></div>
                            <div class="status-subtext text-sm opacity-90">
                                <template x-if="greenhouseMode">
                                    <div class="space-y-1">
                                        <div class="flex items-center gap-2">
                                            <svg class="w-4 h-4 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.111 16.404a5.5 5.5 0 017.778 0M12 20h.01m-7.08-7.071c3.904-3.905 10.236-3.905 14.141 0M1.394 9.393c5.857-5.857 15.355-5.857 21.213 0"/>
                                            </svg>
                                            <span x-text="greenhouseSSID || 'easeOS-Greenhouse'"></span>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <svg class="w-4 h-4 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
                                            </svg>
                                            <span x-text="greenhousePassword || 'No password'"></span>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <svg class="w-4 h-4 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"/>
                                            </svg>
                                            <span x-text="(connectedDevices || 0) + ' device' + ((connectedDevices || 0) === 1 ? '' : 's') + ' connected'"></span>
                                        </div>
                                    </div>
                                </template>
                                <template x-if="!greenhouseMode">
                                    <span>System running normally</span>
                                </template>
                            </div>
                        </div>
                        <div class="bg-white rounded-3xl p-6 shadow-card border border-gray-100">
                            <h3 class="text-sm font-semibold text-gray-400 mb-1">APPS PLANTED</h3>
                            <div class="text-3xl font-extrabold text-gray-800" x-text="Object.values(config.apps || {}).filter(a => a.enable).length"></div>
                        </div>
                        <div class="bg-white rounded-3xl p-6 shadow-card border border-gray-100">
                            <h3 class="text-sm font-semibold text-gray-400 mb-1">PENDING</h3>
                            <div class="text-3xl font-extrabold" :class="pendingCount > 0 ? 'text-ease-terracotta' : 'text-gray-800'" x-text="pendingCount"></div>
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-r from-ease-cream to-green-50 rounded-3xl p-6 border border-ease-mint">
                        <h3 class="font-bold text-ease-forest mb-2">Welcome to easeOS</h3>
                        <p class="text-ease-soil">Your digital garden is ready. Head to the <span class="font-bold">Garden</span> to plant new apps. Toggle what you need, then click <span class="font-bold">Grow</span> to cultivate your system.</p>
                    </div>
                </div>
                
                <!-- Garden (Apps) View -->
                <div x-show="currentView === 'garden'" x-cloak class="slide-up">
                    <div class="app-grid grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6">
                        
                        <!-- Dynamic App Tiles - Only Installed Apps -->
                        <template x-for="app in installedApps" :key="app.id">
                            <div class="app-tile rounded-3xl p-6 shadow-card border-2 border-white transition-all flex flex-col"
                                 :style="'background: ' + getAppGradient(app)"
                                 :class="{
                                     'ring-2 ring-ease-terracotta ring-offset-2 pending-pulse': getAppState(app.id) === 'pending'
                                 }">
                                
                                <div class="flex justify-between items-start mb-4">
                                    <!-- App Icon with fallback -->
                                    <div class="w-14 h-14 rounded-2xl flex items-center justify-center p-2.5 shadow-lg bg-white/20 backdrop-blur-sm">
                                        <div class="w-full h-full" x-html="(app.icon?.svg || app.icon) || defaultAppIcon"></div>
                                    </div>
                                    <span class="text-xs font-bold px-3 py-1 rounded-full"
                                          :class="{
                                              'bg-white/30 text-white': getAppState(app.id) === 'installed',
                                              'bg-ease-terracotta/80 text-white': getAppState(app.id) === 'pending',
                                              'bg-white/20 text-white/90': getAppState(app.id) === 'available'
                                          }"
                                          x-text="getAppState(app.id) === 'installed' ? 'PLANTED' : getAppState(app.id) === 'pending' ? 'SEEDED' : 'AVAILABLE'">
                                    </span>
                                </div>
                                
                                <h3 class="text-xl font-extrabold text-white mb-2 drop-shadow-md" x-text="app.name"></h3>
                                <p class="text-white font-medium text-sm mb-4 leading-relaxed flex-1 drop-shadow-sm" x-text="app.description"></p>
                                
                                <button @click="toggleApp(app.id)"
                                        class="w-full py-3 rounded-2xl font-bold text-base transition-all text-center active:scale-95"
                                        :class="{
                                            'bg-white/10 hover:bg-red-500 text-white shadow-lg hover:shadow-xl': getAppState(app.id) === 'installed',
                                            'bg-orange-500 hover:bg-orange-600 text-white shadow-lg hover:shadow-xl': getAppState(app.id) === 'pending',
                                            'bg-white/90 hover:bg-white text-ease-forest shadow-lg hover:shadow-xl': getAppState(app.id) === 'available'
                                        }"
                                        x-text="getAppState(app.id) === 'installed' ? 'Uproot' : getAppState(app.id) === 'pending' ? 'Undo' : 'Plant'">
                                </button>
                            </div>
                        </template>
                        
                        <!-- More Seeds - Go to Store -->
                        <div @click="currentView = 'store'" 
                             class="app-tile rounded-3xl p-6 border-2 border-dashed border-white/50 flex flex-col items-center justify-center text-center cursor-pointer hover:border-ease-leaf hover:bg-ease-leaf/5 transition-all group bg-white/30 backdrop-blur-sm">
                            <div class="w-14 h-14 bg-white/50 group-hover:bg-ease-leaf/20 rounded-2xl flex items-center justify-center mb-4 transition-colors">
                                <svg class="w-7 h-7 text-gray-500 group-hover:text-ease-leaf transition-colors" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                                </svg>
                            </div>
                            <h3 class="text-lg font-bold text-gray-700 group-hover:text-ease-forest mb-1 transition-colors">More Seeds</h3>
                            <p class="text-sm text-gray-500 group-hover:text-ease-sage transition-colors">Browse the store</p>
                        </div>
                        
                    </div>
                </div>
                
                <!-- Store View -->
                <div x-show="currentView === 'store'" x-cloak class="slide-up">
                    <!-- Store Header -->
                    <div class="mb-6">
                        <div class="flex flex-col md:flex-row md:items-center gap-4 mb-4">
                            <div class="flex-1">
                                <div class="relative">
                                    <input type="text" 
                                           x-model="storeSearchQuery"
                                           placeholder="Search apps..."
                                           class="w-full px-4 py-3 pl-12 bg-white/50 backdrop-blur-lg rounded-2xl border border-white/40 focus:border-ease-leaf focus:bg-white/80 focus:ring-0 outline-none transition-all">
                                    <svg class="w-5 h-5 absolute left-4 top-1/2 -translate-y-1/2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                                    </svg>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Category Pills -->
                        <div class="flex flex-wrap gap-2">
                            <button @click="storeSelectedCategory = null"
                                    class="px-4 py-2 rounded-full text-sm font-bold transition-all"
                                    :class="storeSelectedCategory === null 
                                        ? 'bg-gradient-to-r from-ease-leaf to-ease-sage text-white shadow-sm' 
                                        : 'bg-white/50 backdrop-blur-lg text-gray-600 hover:bg-white/70'">
                                All Seeds
                            </button>
                            <template x-for="cat in storeCategories" :key="cat">
                                <button @click="storeSelectedCategory = cat"
                                        class="px-4 py-2 rounded-full text-sm font-bold transition-all capitalize"
                                        :class="storeSelectedCategory === cat 
                                            ? 'bg-gradient-to-r from-ease-leaf to-ease-sage text-white shadow-sm' 
                                            : 'bg-white/50 backdrop-blur-lg text-gray-600 hover:bg-white/70'"
                                        x-text="cat">
                                </button>
                            </template>
                        </div>
                    </div>
                    
                    <!-- Loading State -->
                    <div x-show="storeLoading" class="text-center py-12">
                        <div class="w-12 h-12 border-4 border-ease-leaf/30 border-t-ease-leaf rounded-full animate-spin mx-auto mb-4"></div>
                        <p class="text-gray-500">Loading seeds...</p>
                    </div>
                    
                    <!-- Store Grid -->
                    <div x-show="!storeLoading" class="app-grid grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6">
                        <template x-for="app in filteredStoreApps" :key="app.id">
                            <div class="app-tile rounded-3xl p-6 shadow-card border-2 border-white transition-all flex flex-col"
                                 :style="'background: ' + getAppGradient(app)"
                                 :class="{
                                     'ring-2 ring-ease-terracotta ring-offset-2 pending-pulse': getAppState(app.id) === 'pending'
                                 }">
                                
                                <div class="flex justify-between items-start mb-4">
                                    <!-- App Icon with fallback -->
                                    <div class="w-14 h-14 rounded-2xl flex items-center justify-center p-2.5 shadow-lg bg-white/20 backdrop-blur-sm">
                                        <div class="w-full h-full" x-html="(app.icon?.svg || app.icon) || defaultAppIcon"></div>
                                    </div>
                                    <div class="flex flex-col items-end gap-1">
                                        <span class="text-xs font-bold px-3 py-1 rounded-full"
                                              :class="{
                                                  'bg-white/30 text-white': getAppState(app.id) === 'installed',
                                                  'bg-ease-terracotta/80 text-white': getAppState(app.id) === 'pending',
                                                  'bg-white/20 text-white/90': getAppState(app.id) === 'available'
                                              }"
                                              x-text="getAppState(app.id) === 'installed' ? 'PLANTED' : getAppState(app.id) === 'pending' ? 'SEEDED' : 'AVAILABLE'">
                                        </span>
                                        <span class="text-xs font-semibold text-white/90 capitalize" x-text="app.category"></span>
                                    </div>
                                </div>
                                
                                <h3 class="text-xl font-extrabold text-white mb-1 drop-shadow-md" x-text="app.name"></h3>
                                <p class="text-xs font-semibold text-white/80 mb-2" x-text="'v' + app.version"></p>
                                <p class="text-white font-medium text-sm mb-4 leading-relaxed flex-1 drop-shadow-sm" x-text="app.description"></p>
                                
                                <!-- Tags -->
                                <div x-show="app.tags && app.tags.length" class="flex flex-wrap gap-1 mb-4">
                                    <template x-for="tag in (app.tags || []).slice(0, 3)" :key="tag">
                                        <span class="text-xs font-semibold px-2 py-0.5 rounded-full bg-white/30 text-white" x-text="tag"></span>
                                    </template>
                                </div>
                                
                                <button @click="toggleApp(app.id)"
                                        class="w-full py-3 rounded-2xl font-bold text-base transition-all text-center active:scale-95"
                                        :class="{
                                            'bg-white/10 hover:bg-red-500 text-white shadow-lg hover:shadow-xl': getAppState(app.id) === 'installed',
                                            'bg-orange-500 hover:bg-orange-600 text-white shadow-lg hover:shadow-xl': getAppState(app.id) === 'pending',
                                            'bg-white/90 hover:bg-white text-ease-forest shadow-lg hover:shadow-xl': getAppState(app.id) === 'available'
                                        }"
                                        x-text="getAppState(app.id) === 'installed' ? 'Uproot' : getAppState(app.id) === 'pending' ? 'Undo' : 'Plant'">
                                </button>
                            </div>
                        </template>
                        
                        <!-- Empty State -->
                        <div x-show="filteredStoreApps.length === 0 && !storeLoading" 
                             class="col-span-full text-center py-12">
                            <svg class="w-16 h-16 mx-auto text-gray-300 mb-4" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/>
                            </svg>
                            <p class="text-gray-500">No seeds found</p>
                            <p class="text-sm text-gray-400 mt-1">Try adjusting your search</p>
                        </div>
                    </div>
                </div>
                
                <!-- Settings View -->
                <div x-show="currentView === 'settings'" x-cloak class="slide-up space-y-6">
                    
                    <!-- System Settings -->
                    <div class="bg-white/70 backdrop-blur-2xl rounded-3xl p-6 shadow-card border border-white/40">
                        <div class="flex items-center gap-3 mb-6">
                            <div class="w-10 h-10 bg-ease-leaf/10 rounded-xl flex items-center justify-center">
                                <svg class="w-5 h-5 text-ease-leaf" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>
                            </div>
                            <div>
                                <h3 class="font-bold text-gray-800">System</h3>
                                <p class="text-gray-500 text-sm">Basic system settings</p>
                            </div>
                        </div>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-semibold text-gray-600 mb-2">Hostname</label>
                                <input type="text" 
                                       :value="config.hostName || 'easyos'"
                                       @input="config.hostName = $event.target.value; onConfigChange()"
                                       class="w-full px-4 py-3 bg-gray-50 rounded-xl border-2 border-gray-200 focus:border-ease-leaf focus:ring-0 outline-none transition-colors"
                                       placeholder="easyos">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-600 mb-2">Time Zone</label>
                                <select :value="config.timeZone || 'UTC'"
                                        @change="config.timeZone = $event.target.value; onConfigChange()"
                                        class="w-full px-4 py-3 bg-gray-50 rounded-xl border-2 border-gray-200 focus:border-ease-leaf focus:ring-0 outline-none transition-colors">
                                    <option value="UTC">UTC</option>
                                    <option value="America/New_York">America/New_York</option>
                                    <option value="America/Chicago">America/Chicago</option>
                                    <option value="America/Denver">America/Denver</option>
                                    <option value="America/Los_Angeles">America/Los_Angeles</option>
                                    <option value="Europe/London">Europe/London</option>
                                    <option value="Europe/Paris">Europe/Paris</option>
                                    <option value="Europe/Berlin">Europe/Berlin</option>
                                    <option value="Asia/Tokyo">Asia/Tokyo</option>
                                    <option value="Asia/Shanghai">Asia/Shanghai</option>
                                    <option value="Australia/Sydney">Australia/Sydney</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-600 mb-2">Swap Size (MB)</label>
                                <input type="number" 
                                       :value="config.swapMiB || 4096"
                                       @input="config.swapMiB = parseInt($event.target.value); onConfigChange()"
                                       class="w-full px-4 py-3 bg-gray-50 rounded-xl border-2 border-gray-200 focus:border-ease-leaf focus:ring-0 outline-none transition-colors"
                                       min="1024" max="32768" step="1024">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Network Settings -->
                    <div class="bg-white/70 backdrop-blur-2xl rounded-3xl p-6 shadow-card border border-white/40">
                        <div class="flex items-center gap-3 mb-6">
                            <div class="w-10 h-10 bg-blue-500/10 rounded-xl flex items-center justify-center">
                                <svg class="w-5 h-5 text-blue-500" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/></svg>
                            </div>
                            <div>
                                <h3 class="font-bold text-gray-800">Network & Hotspot</h3>
                                <p class="text-gray-500 text-sm">WiFi hotspot and network settings</p>
                            </div>
                        </div>
                        <div class="space-y-4">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-semibold text-gray-600 mb-2">Hotspot SSID</label>
                                    <input type="text" 
                                           :value="config.network?.ssid || 'easeOS-Setup'"
                                           @input="if(!config.network) config.network = {}; config.network.ssid = $event.target.value; onConfigChange()"
                                           class="w-full px-4 py-3 bg-gray-50 rounded-xl border-2 border-gray-200 focus:border-ease-leaf focus:ring-0 outline-none transition-colors">
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-600 mb-2">WiFi Channel</label>
                                    <select :value="config.network?.wifiChannel || '6'"
                                            @change="if(!config.network) config.network = {}; config.network.wifiChannel = $event.target.value; onConfigChange()"
                                            class="w-full px-4 py-3 bg-gray-50 rounded-xl border-2 border-gray-200 focus:border-ease-leaf focus:ring-0 outline-none transition-colors">
                                        <option value="1">1</option>
                                        <option value="6">6</option>
                                        <option value="11">11</option>
                                    </select>
                                </div>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-semibold text-gray-600 mb-2">Download Speed (Mbps)</label>
                                    <input type="text" 
                                           :value="config.network?.qosDownloadMbps || '100'"
                                           @input="if(!config.network) config.network = {}; config.network.qosDownloadMbps = $event.target.value; onConfigChange()"
                                           class="w-full px-4 py-3 bg-gray-50 rounded-xl border-2 border-gray-200 focus:border-ease-leaf focus:ring-0 outline-none transition-colors">
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-600 mb-2">Upload Speed (Mbps)</label>
                                    <input type="text" 
                                           :value="config.network?.qosUploadMbps || '20'"
                                           @input="if(!config.network) config.network = {}; config.network.qosUploadMbps = $event.target.value; onConfigChange()"
                                           class="w-full px-4 py-3 bg-gray-50 rounded-xl border-2 border-gray-200 focus:border-ease-leaf focus:ring-0 outline-none transition-colors">
                                </div>
                            </div>
                            <div class="flex flex-wrap gap-4 pt-2">
                                <label class="flex items-center gap-3 cursor-pointer">
                                    <input type="checkbox" 
                                           :checked="config.network?.qosEnabled !== false"
                                           @change="if(!config.network) config.network = {}; config.network.qosEnabled = $event.target.checked; onConfigChange()"
                                           class="w-5 h-5 rounded border-gray-300 text-ease-leaf focus:ring-ease-leaf">
                                    <span class="text-sm font-medium text-gray-700">QoS Enabled</span>
                                </label>
                                <label class="flex items-center gap-3 cursor-pointer">
                                    <input type="checkbox" 
                                           :checked="config.network?.clientIsolation !== false"
                                           @change="if(!config.network) config.network = {}; config.network.clientIsolation = $event.target.checked; onConfigChange()"
                                           class="w-5 h-5 rounded border-gray-300 text-ease-leaf focus:ring-ease-leaf">
                                    <span class="text-sm font-medium text-gray-700">Client Isolation</span>
                                </label>
                                <label class="flex items-center gap-3 cursor-pointer">
                                    <input type="checkbox" 
                                           :checked="config.network?.hotspotAllowWAN === true"
                                           @change="if(!config.network) config.network = {}; config.network.hotspotAllowWAN = $event.target.checked; onConfigChange()"
                                           class="w-5 h-5 rounded border-gray-300 text-ease-leaf focus:ring-ease-leaf">
                                    <span class="text-sm font-medium text-gray-700">Allow WAN Access</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Backup Settings -->
                    <div class="bg-white/70 backdrop-blur-2xl rounded-3xl p-6 shadow-card border border-white/40">
                        <div class="flex items-center gap-3 mb-6">
                            <div class="w-10 h-10 bg-purple-500/10 rounded-xl flex items-center justify-center">
                                <svg class="w-5 h-5 text-purple-500" fill="currentColor" viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14h-2V9h-2l3-4 3 4h-2v8z"/></svg>
                            </div>
                            <div>
                                <h3 class="font-bold text-gray-800">Backup</h3>
                                <p class="text-gray-500 text-sm">Automated backup settings</p>
                            </div>
                            <label class="ml-auto flex items-center gap-3 cursor-pointer">
                                <input type="checkbox" 
                                       :checked="config.backup?.enable === true"
                                       @change="if(!config.backup) config.backup = {}; config.backup.enable = $event.target.checked; onConfigChange()"
                                       class="w-5 h-5 rounded border-gray-300 text-ease-leaf focus:ring-ease-leaf">
                                <span class="text-sm font-medium text-gray-700">Enabled</span>
                            </label>
                        </div>
                        <div class="space-y-4" x-show="config.backup?.enable">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-semibold text-gray-600 mb-2">Backup Target</label>
                                    <input type="text" 
                                           :value="config.backup?.target || '/srv/backup'"
                                           @input="if(!config.backup) config.backup = {}; config.backup.target = $event.target.value; onConfigChange()"
                                           class="w-full px-4 py-3 bg-gray-50 rounded-xl border-2 border-gray-200 focus:border-ease-leaf focus:ring-0 outline-none transition-colors"
                                           placeholder="/srv/backup">
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-600 mb-2">Schedule</label>
                                    <select :value="config.backup?.onCalendar || 'daily'"
                                            @change="if(!config.backup) config.backup = {}; config.backup.onCalendar = $event.target.value; onConfigChange()"
                                            class="w-full px-4 py-3 bg-gray-50 rounded-xl border-2 border-gray-200 focus:border-ease-leaf focus:ring-0 outline-none transition-colors">
                                        <option value="hourly">Hourly</option>
                                        <option value="daily">Daily</option>
                                        <option value="weekly">Weekly</option>
                                        <option value="monthly">Monthly</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Advanced (Raw JSON) -->
                    <div class="bg-white/70 backdrop-blur-2xl rounded-3xl p-6 shadow-card border border-white/40">
                        <details class="group">
                            <summary class="flex items-center gap-3 cursor-pointer list-none">
                                <div class="w-10 h-10 bg-gray-500/10 rounded-xl flex items-center justify-center">
                                    <svg class="w-5 h-5 text-gray-500" fill="currentColor" viewBox="0 0 24 24"><path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"/></svg>
                                </div>
                                <div class="flex-1">
                                    <h3 class="font-bold text-gray-800">Advanced Configuration</h3>
                                    <p class="text-gray-500 text-sm">Edit raw JSON config (for experts)</p>
                                </div>
                                <svg class="w-5 h-5 text-gray-400 transition-transform group-open:rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
                            </summary>
                            <div class="mt-4">
                                <textarea x-model="configText" 
                                          @input="onConfigEdit()"
                                          class="w-full h-64 p-5 bg-gray-50 rounded-2xl border-2 border-gray-200 focus:border-ease-leaf focus:ring-0 outline-none font-mono text-sm resize-none transition-colors"></textarea>
                            </div>
                        </details>
                    </div>
                    
                </div>
                
                <!-- Logs View -->
                <div x-show="currentView === 'logs'" x-cloak class="slide-up h-full">
                    <div class="bg-ease-soil rounded-3xl p-6 h-full overflow-hidden flex flex-col">
                        <div class="flex items-center gap-2 mb-4">
                            <div class="w-3 h-3 rounded-full bg-ease-terracotta"></div>
                            <div class="w-3 h-3 rounded-full bg-ease-sage"></div>
                            <div class="w-3 h-3 rounded-full bg-ease-leaf"></div>
                            <span class="ml-3 text-ease-mint/60 text-sm font-mono">growth logs</span>
                        </div>
                        <pre class="flex-1 overflow-y-auto text-ease-mint font-mono text-sm leading-relaxed" x-text="logOutput || 'Watching the garden grow...'"></pre>
                    </div>
                </div>
                
            </div>
            
            <!-- Floating Action Bar -->
            <div class="absolute bottom-0 left-0 right-0 p-3 md:p-6 transition-all duration-500 mobile-action-bar safe-bottom"
                 style="bottom: 56px;"
                 :class="pendingCount > 0 ? 'translate-y-0 opacity-100' : 'translate-y-full opacity-0'">
                <div class="bg-white/80 backdrop-blur-2xl rounded-2xl md:rounded-3xl p-4 md:p-5 shadow-lg border border-white/40 flex flex-col md:flex-row items-stretch md:items-center justify-between gap-3 md:gap-0">
                    <div class="flex items-center gap-3 md:gap-4">
                        <div class="w-10 h-10 md:w-12 md:h-12 bg-ease-terracotta/10 rounded-xl md:rounded-2xl flex items-center justify-center flex-shrink-0">
                            <span class="text-xl md:text-2xl font-extrabold text-ease-terracotta" x-text="pendingCount"></span>
                        </div>
                        <div>
                            <div class="font-bold text-gray-800 text-sm md:text-base">Changes Ready</div>
                            <div class="text-xs md:text-sm text-gray-500">Apply to update your garden</div>
                        </div>
                    </div>
                    <div class="flex gap-2 md:gap-3 action-buttons">
                        <button @click="revertAll()"
                                class="touch-feedback flex-1 md:flex-initial px-4 md:px-6 py-2.5 md:py-3 bg-white/50 backdrop-blur-sm text-gray-600 border border-gray-200/50 rounded-xl md:rounded-2xl font-bold hover:bg-white/70 transition-all active:scale-95 text-sm md:text-base">
                            Discard
                        </button>
                        <button @click="applyChanges()"
                                :disabled="systemStatus === 'active'"
                                class="touch-feedback flex-1 md:flex-initial px-4 md:px-8 py-2.5 md:py-3 bg-gradient-to-r from-ease-leaf to-ease-sage text-white rounded-xl md:rounded-2xl font-bold shadow-lg hover:shadow-xl hover:scale-[1.02] active:scale-95 transition-all disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100 flex items-center justify-center gap-2 text-sm md:text-base">
                            <svg class="w-4 h-4 md:w-5 md:h-5" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                            </svg>
                            <span x-text="systemStatus === 'active' ? 'Applying...' : 'Apply'"></span>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Mobile Bottom Navigation - YouTube-style unified bar -->
            <nav class="mobile-bottom-nav">
                <div class="nav-container">
                    <!-- Home -->
                    <button @click="currentView = 'home'" 
                            class="nav-item"
                            :class="currentView === 'home' ? 'active' : 'inactive'">
                        <svg fill="currentColor" viewBox="0 0 24 24">
                            <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
                        </svg>
                        <span>Home</span>
                    </button>
                    
                    <!-- Garden (Apps) -->
                    <button @click="currentView = 'garden'" 
                            class="nav-item"
                            :class="currentView === 'garden' ? 'active' : 'inactive'">
                        <svg fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 22c4.97 0 9-4.03 9-9-4.97 0-9 4.03-9 9zm-7-9c0-2.76 2.24-5 5-5v-5c0-.55.45-1 1-1h2c.55 0 1 .45 1 1v5c2.76 0 5 2.24 5 5h-14z"/>
                        </svg>
                        <span>Garden</span>
                    </button>
                    
                    <!-- Settings -->
                    <button @click="currentView = 'settings'" 
                            class="nav-item"
                            :class="currentView === 'settings' ? 'active' : 'inactive'">
                        <svg fill="currentColor" viewBox="0 0 24 24">
                            <path d="M19.14 12.94c.04-.31.06-.63.06-.94 0-.31-.02-.63-.06-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/>
                        </svg>
                        <span>Settings</span>
                    </button>
                </div>
            </nav>
            
        </main>
    </div>
    
    <script>
        function easeOS() {
            return {
                currentView: 'home',
                config: {},
                originalConfig: {},
                configText: '',
                systemStatus: 'inactive',
                logOutput: '',
                clock: '',
                ipAddress: '',
                isHappy: false,
                isWatering: false,
                wateringTimer: null,
                happyTimer: null,
                sidebarOpen: false,
                isMobile: false,
                timeOfDay: null, // 'sunrise', 'day', 'sunset', 'night' - set by updateTimeOfDay on init
                manualThemeOverride: null, // null = auto, 'day' or 'night' = manual
                starsGenerated: false,
                shootingStarTimer: null,
                isConnected: true,
                reconnectAttempts: 0,
                lastConfigBackup: null,
                greenhouseMode: false,
                greenhouseSSID: null,
                greenhousePassword: null,
                connectedDevices: 0,
                
                // Setup Wizard state
                setupMode: false,
                setupStep: 'wake', // 'wake', 'account', 'password', 'storage', 'soil', 'germinate', 'alive'
                testMode: false, // Set to true when running on dev server
                isISOMode: false, // True when running from ISO installer
                cooperDropped: false, // Triggers drop-in animation
                transitionDirection: 'forward', // 'forward' or 'back' for animation direction
                
                // Account creation
                setupUsername: '',
                setupPassword: '',
                setupPasswordConfirm: '',
                setupHostname: '',
                setupAccountError: null,
                setupUsernameError: null,
                
                // Storage detection
                storageDevices: [],
                storageLoading: true,
                selectedDrive: null,
                confirmDataLoss: false,
                isVM: false,
                autoInstallDrive: null,
                showDriveSelector: false, // Only show if multiple drives or partitioned drive
                autoSelectedDrive: null, // Automatically selected clean drive
                forceManualSelection: false, // User wants to choose manually
                
                get selectedDriveHasData() {
                    const drive = this.storageDevices.find(d => d.path === this.selectedDrive);
                    return drive ? drive.hasData : false;
                },
                
                get selectedDriveInfo() {
                    return this.storageDevices.find(d => d.path === this.selectedDrive);
                },
                
                // WiFi
                wifiNetworks: [],
                wifiScanning: false,
                selectedNetwork: null,
                wifiPassword: '',
                showAllNetworks: false,
                
                // Germination progress
                germinationProgress: 0,
                germinationStatus: 'Rooting...',
                germinationDetail: 'Finding nutrients in the soil',
                germinationError: null,
                encryptionKey: null, // Session key from server
                
                get topNetworks() {
                    // Return top 3 strongest networks
                    return this.wifiNetworks.slice(0, 3);
                },
                
                get otherNetworks() {
                    // Return the rest (the "weeds")
                    return this.wifiNetworks.slice(3);
                },
                
                get isNightMode() {
                    return this.timeOfDay === 'night';
                },
                
                get timeOfDayClass() {
                    return {
                        'sunrise-mode': this.timeOfDay === 'sunrise',
                        'day-mode': this.timeOfDay === 'day',
                        'sunset-mode': this.timeOfDay === 'sunset',
                        'night-mode': this.timeOfDay === 'night'
                    };
                },
                
                navItems: [
                    { id: 'home', label: 'Home', icon: '<svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>' },
                    { id: 'garden', label: 'Garden', icon: '<svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M12 22c4.97 0 9-4.03 9-9-4.97 0-9 4.03-9 9zM5.6 10.25c0 1.38 1.12 2.5 2.5 2.5.53 0 1.01-.16 1.42-.44l-.02.19c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5l-.02-.19c.4.28.89.44 1.42.44 1.38 0 2.5-1.12 2.5-2.5 0-1-.59-1.85-1.43-2.25.84-.4 1.43-1.25 1.43-2.25 0-1.38-1.12-2.5-2.5-2.5-.53 0-1.01.16-1.42.44l.02-.19C14.5 4.12 13.38 3 12 3S9.5 4.12 9.5 5.5l.02.19c-.4-.28-.89-.44-1.42-.44-1.38 0-2.5 1.12-2.5 2.5 0 1 .59 1.85 1.43 2.25-.84.4-1.43 1.25-1.43 2.25zM12 5.5c1.38 0 2.5 1.12 2.5 2.5s-1.12 2.5-2.5 2.5S9.5 9.38 9.5 8s1.12-2.5 2.5-2.5zM3 13c0 4.97 4.03 9 9 9 0-4.97-4.03-9-9-9z"/></svg>' },
                    { id: 'store', label: 'Store', icon: '<svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M18.36 9l.6 3H5.04l.6-3h12.72M20 4H4v2h16V4zm0 3H4l-1 5v2h1v6h10v-6h4v6h2v-6h1v-2l-1-5zM6 18v-4h6v4H6z"/></svg>' },
                    { id: 'settings', label: 'Settings', icon: '<svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M19.43 12.98c.04-.32.07-.64.07-.98s-.03-.66-.07-.98l2.11-1.65c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.3-.61-.22l-2.49 1c-.52-.4-1.08-.73-1.69-.98l-.38-2.65C14.46 2.18 14.25 2 14 2h-4c-.25 0-.46.18-.49.42l-.38 2.65c-.61.25-1.17.59-1.69.98l-2.49-1c-.23-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64l2.11 1.65c-.04.32-.07.65-.07.98s.03.66.07.98l-2.11 1.65c-.19.15-.24.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49-1c.52.4 1.08.73 1.69.98l.38 2.65c.03.24.24.42.49.42h4c.25 0 .46-.18.49-.42l.38-2.65c.61-.25 1.17-.59 1.69-.98l2.49 1c.23.09.49 0 .61-.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.65zM12 15.5c-1.93 0-3.5-1.57-3.5-3.5s1.57-3.5 3.5-3.5 3.5 1.57 3.5 3.5-1.57 3.5-3.5 3.5z"/></svg>' },
                    { id: 'logs', label: 'Logs', icon: '<svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm2 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/></svg>' },
                ],
                
                // Store state
                storeApps: [],
                storeCategories: [],
                storeSearchQuery: '',
                storeSelectedCategory: null,
                storeLoading: false,
                
                // GitHub raw content URL for store apps
                githubStoreUrl: 'https://raw.githubusercontent.com/doughty247/easyos/main/store/apps',
                storeAppFiles: ['homeassistant', 'immich', 'jellyfin', 'nextcloud', 'vaultwarden'],
                
                get filteredStoreApps() {
                    let apps = this.storeApps;
                    
                    // Filter by category
                    if (this.storeSelectedCategory) {
                        apps = apps.filter(a => a.category === this.storeSelectedCategory);
                    }
                    
                    // Filter by search
                    if (this.storeSearchQuery) {
                        const q = this.storeSearchQuery.toLowerCase();
                        apps = apps.filter(a => 
                            a.name.toLowerCase().includes(q) ||
                            a.description.toLowerCase().includes(q) ||
                            (a.tags || []).some(t => t.toLowerCase().includes(q))
                        );
                    }
                    
                    return apps;
                },
                
                get installedApps() {
                    // Get apps that are in both store and config
                    return this.storeApps.filter(app => {
                        return this.config?.apps?.[app.id]?.enable || 
                               this.originalConfig?.apps?.[app.id]?.enable;
                    });
                },
                
                get pendingCount() {
                    return JSON.stringify(this.config) !== JSON.stringify(this.originalConfig) ? 1 : 0;
                },
                
                async init() {
                    this.ipAddress = window.location.hostname;
                    this.updateClock();
                    setInterval(() => this.updateClock(), 1000);
                    this.handleResize();
                    
                    // Mobile keyboard scroll fix - when keyboard opens, scroll active input into view
                    window.addEventListener('resize', () => {
                        const active = document.activeElement;
                        if (active && (active.tagName === 'INPUT' || active.tagName === 'TEXTAREA')) {
                            setTimeout(() => {
                                active.scrollIntoView({ behavior: 'smooth', block: 'center' });
                            }, 100);
                        }
                    });
                    
                    // Detect test mode (dev server runs on 8089)
                    this.testMode = window.location.port === '8089';
                    
                    // Check for saved manual theme override
                    const savedTheme = localStorage.getItem('easeOS-theme');
                    if (savedTheme && savedTheme !== 'auto') {
                        this.manualThemeOverride = savedTheme;
                    }
                    
                    // Set initial time of day and start auto-update
                    this.updateTimeOfDay();
                    setInterval(() => this.updateTimeOfDay(), 60000); // Check every minute
                    
                    // Schedule rare shooting star (average once per hour)
                    this.scheduleShootingStar();
                    
                    // Check if we're in ISO/installer mode
                    try {
                        const sysRes = await fetch('/api/system/info');
                        if (sysRes.ok) {
                            const sysInfo = await sysRes.json();
                            this.isISOMode = sysInfo.isISO || false;
                        }
                    } catch (e) {
                        console.log('Could not detect system mode');
                    }
                    
                    await this.loadConfig();
                    
                    // Check if we're in first-run/setup mode
                    if (this.config.mode === 'first-run' || this.greenhouseMode) {
                        this.setupMode = true;
                        this.setupStep = 'wake';
                        // Trigger Cooper drop-in animation after a brief delay
                        setTimeout(() => {
                            this.cooperDropped = true;
                        }, 300);
                        // Don't pre-scan WiFi, wait until that step
                    }
                    
                    await this.loadStoreApps();
                    this.pollStatus();
                },
                
                // ===== SETUP WIZARD METHODS =====
                
                // Navigate between setup steps with proper animations
                goToStep(step) {
                    const steps = ['wake', 'account', 'password', 'storage', 'soil', 'germinate', 'alive'];
                    const currentIndex = steps.indexOf(this.setupStep);
                    const nextIndex = steps.indexOf(step);
                    this.transitionDirection = nextIndex > currentIndex ? 'forward' : 'back';
                    
                    // Reset storage-specific state when navigating away
                    if (step !== 'storage') {
                        this.showDriveSelector = false;
                    }
                    
                    this.setupStep = step;
                    console.log('goToStep:', step, 'direction:', this.transitionDirection);
                },
                
                // Encryption using AES-256-GCM with server-provided key
                // Note: In production, use TLS. This adds defense-in-depth for the captive portal scenario
                // where the hotspot connection itself is unencrypted.
                // crypto.subtle is only available in secure contexts (HTTPS, localhost)
                
                cryptoAvailable() {
                    return typeof crypto !== 'undefined' && 
                           typeof crypto.subtle !== 'undefined' &&
                           window.isSecureContext;
                },
                
                async fetchEncryptionKey() {
                    // Skip encryption if crypto.subtle not available
                    if (!this.cryptoAvailable()) {
                        console.warn('Crypto not available (insecure context). Encryption disabled.');
                        return null;
                    }
                    try {
                        const res = await fetch('/api/crypto/session');
                        if (res.ok) {
                            const data = await res.json();
                            this.encryptionKey = data.key;
                            return data.key;
                        }
                    } catch (e) {
                        console.error('Failed to fetch encryption key:', e);
                    }
                    return null;
                },
                
                // Derive AES key from the shared secret
                async deriveAESKey(secret) {
                    if (!this.cryptoAvailable()) return null;
                    const encoder = new TextEncoder();
                    const keyMaterial = await crypto.subtle.importKey(
                        'raw',
                        encoder.encode(secret),
                        'PBKDF2',
                        false,
                        ['deriveKey']
                    );
                    return await crypto.subtle.deriveKey(
                        {
                            name: 'PBKDF2',
                            salt: encoder.encode('easeOS-wifi-salt'),
                            iterations: 100000,
                            hash: 'SHA-256'
                        },
                        keyMaterial,
                        { name: 'AES-GCM', length: 256 },
                        false,
                        ['encrypt', 'decrypt']
                    );
                },
                
                // AES-256-GCM encryption
                async encryptData(data, keyString) {
                    if (!keyString || !this.cryptoAvailable()) return null;
                    try {
                        const key = await this.deriveAESKey(keyString);
                        if (!key) return null;
                        const encoder = new TextEncoder();
                        const iv = crypto.getRandomValues(new Uint8Array(12));
                        const encrypted = await crypto.subtle.encrypt(
                            { name: 'AES-GCM', iv: iv },
                            key,
                            encoder.encode(JSON.stringify(data))
                        );
                        // Combine IV + ciphertext and base64 encode
                        const combined = new Uint8Array(iv.length + encrypted.byteLength);
                        combined.set(iv);
                        combined.set(new Uint8Array(encrypted), iv.length);
                        return btoa(String.fromCharCode(...combined));
                    } catch (e) {
                        console.error('Encryption failed:', e);
                        return null;
                    }
                },
                
                // AES-256-GCM decryption
                async decryptData(encryptedBase64, keyString) {
                    if (!keyString || !encryptedBase64 || !this.cryptoAvailable()) return null;
                    try {
                        const key = await this.deriveAESKey(keyString);
                        if (!key) return null;
                        const combined = Uint8Array.from(atob(encryptedBase64), c => c.charCodeAt(0));
                        const iv = combined.slice(0, 12);
                        const ciphertext = combined.slice(12);
                        const decrypted = await crypto.subtle.decrypt(
                            { name: 'AES-GCM', iv: iv },
                            key,
                            ciphertext
                        );
                        return JSON.parse(new TextDecoder().decode(decrypted));
                    } catch (e) {
                        console.error('Decryption failed:', e);
                        return null;
                    }
                },
                
                // Validate username and move to password step
                validateUsername() {
                    this.setupUsernameError = null;
                    
                    // Validate username
                    if (!this.setupUsername || this.setupUsername.length < 3) {
                        this.setupUsernameError = 'Username must be at least 3 characters';
                        return;
                    }
                    if (!/^[a-z][a-z0-9_-]*$/.test(this.setupUsername)) {
                        this.setupUsernameError = 'Must start with a letter, only lowercase, numbers, - or _';
                        return;
                    }
                    
                    // Set default hostname if not provided
                    if (!this.setupHostname) {
                        this.setupHostname = 'easeos';
                    }
                    
                    // Move to password step
                    this.setupStep = 'password';
                },
                
                // Password validation: 8+ chars, 1 uppercase, 1 number, 1 symbol, no spaces
                validatePasswordStrength(password) {
                    if (!password || password.length < 8) {
                        return 'Password must be at least 8 characters';
                    }
                    if (/\s/.test(password)) {
                        return 'Password cannot contain spaces';
                    }
                    if (!/[A-Z]/.test(password)) {
                        return 'Password must contain at least 1 uppercase letter';
                    }
                    if (!/[0-9]/.test(password)) {
                        return 'Password must contain at least 1 number';
                    }
                    if (!/[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?~`]/.test(password)) {
                        return 'Password must contain at least 1 symbol (!@#$%^&* etc.)';
                    }
                    return null; // Valid
                },
                
                // Validate password and move to storage step (ISO) or WiFi step (installed)
                validatePassword() {
                    this.setupAccountError = null;
                    
                    // Check password strength
                    const passwordError = this.validatePasswordStrength(this.setupPassword);
                    if (passwordError) {
                        this.setupAccountError = passwordError;
                        return;
                    }
                    
                    if (this.setupPassword !== this.setupPasswordConfirm) {
                        this.setupAccountError = 'Passwords do not match';
                        return;
                    }
                    
                    // In ISO mode, go to storage selection first
                    if (this.isISOMode) {
                        this.setupStep = 'storage';
                        this.scanStorageDevices();
                    } else {
                        // Already installed, skip storage and go to WiFi
                        this.setupStep = 'soil';
                        this.scanWifiNetworks();
                    }
                },
                
                // Scan for available storage devices
                async scanStorageDevices() {
                    this.storageLoading = true;
                    this.storageDevices = [];
                    this.selectedDrive = null;
                    this.confirmDataLoss = false;
                    this.showDriveSelector = false;
                    
                    try {
                        const res = await fetch('/api/storage/detect');
                        if (res.ok) {
                            const data = await res.json();
                            this.storageDevices = data.drives || [];
                            this.isVM = data.isVM || false;
                            this.autoInstallDrive = data.autoInstallDrive;
                            
                            // Smart auto-selection logic
                            const cleanDrives = this.storageDevices.filter(d => d.isBlank || !d.hasData);
                            const partitionedDrives = this.storageDevices.filter(d => d.hasData);
                            
                            if (this.isVM && this.autoInstallDrive) {
                                // VM mode: auto-select the virtual drive
                                this.selectedDrive = this.autoInstallDrive;
                                this.showDriveSelector = false;
                            } else if (cleanDrives.length === 1 && partitionedDrives.length === 0) {
                                // Single clean drive, no partitioned drives: auto-select and skip selector
                                this.selectedDrive = cleanDrives[0].path;
                                this.showDriveSelector = false;
                            } else if (cleanDrives.length > 0 && partitionedDrives.length === 0) {
                                // Multiple clean drives: select largest, but show selector
                                const largest = cleanDrives.reduce((a, b) => 
                                    this.parseSizeToBytes(a.size) > this.parseSizeToBytes(b.size) ? a : b
                                );
                                this.selectedDrive = largest.path;
                                this.showDriveSelector = true; // Let user change if they want
                            } else if (this.storageDevices.length > 1) {
                                // Multiple drives with some partitioned: show selector
                                // Auto-select largest clean drive if available
                                if (cleanDrives.length > 0) {
                                    const largest = cleanDrives.reduce((a, b) => 
                                        this.parseSizeToBytes(a.size) > this.parseSizeToBytes(b.size) ? a : b
                                    );
                                    this.selectedDrive = largest.path;
                                }
                                this.showDriveSelector = true;
                            } else if (partitionedDrives.length === 1) {
                                // Single partitioned drive: show selector with warning
                                this.selectedDrive = partitionedDrives[0].path;
                                this.showDriveSelector = true;
                            } else {
                                // Fallback: show selector
                                this.showDriveSelector = true;
                            }
                        }
                    } catch (e) {
                        console.error('Failed to scan storage:', e);
                    } finally {
                        this.storageLoading = false;
                    }
                },
                
                // Parse size string to bytes for comparison (e.g., "500G" -> 500000000000)
                parseSizeToBytes(sizeStr) {
                    if (!sizeStr) return 0;
                    const match = sizeStr.match(/^([\d.]+)\s*([KMGTP]?)i?B?$/i);
                    if (!match) return 0;
                    const num = parseFloat(match[1]);
                    const unit = (match[2] || '').toUpperCase();
                    const multipliers = { '': 1, 'K': 1024, 'M': 1024**2, 'G': 1024**3, 'T': 1024**4, 'P': 1024**5 };
                    return num * (multipliers[unit] || 1);
                },
                
                // Select a drive
                selectDrive(drive) {
                    if (this.selectedDrive === drive.path) {
                        // Deselect
                        this.selectedDrive = null;
                        this.confirmDataLoss = false;
                    } else {
                        this.selectedDrive = drive.path;
                        this.confirmDataLoss = false;
                    }
                },
                
                // Confirm storage selection and proceed
                confirmStorage() {
                    if (!this.selectedDrive) return;
                    
                    const drive = this.storageDevices.find(d => d.path === this.selectedDrive);
                    if (drive && drive.hasData && !this.confirmDataLoss) {
                        return; // Need to check the confirmation box
                    }
                    
                    // Move to WiFi selection
                    this.setupStep = 'soil';
                    this.scanWifiNetworks();
                },
                
                async scanWifiNetworks() {
                    this.wifiScanning = true;
                    this.wifiNetworks = [];
                    
                    try {
                        // Check if crypto is available (secure context)
                        const cryptoOk = this.cryptoAvailable();
                        
                        if (cryptoOk) {
                            // First, get encryption key from server
                            await this.fetchEncryptionKey();
                        }
                        
                        // Request encrypted or plain based on capability
                        const url = cryptoOk ? '/api/wifi/scan' : '/api/wifi/scan?plain=1';
                        const res = await fetch(url);
                        
                        if (res.ok) {
                            const data = await res.json();
                            console.log('WiFi scan response:', data);
                            
                            // Check if data is encrypted
                            if (data.encrypted && this.encryptionKey && cryptoOk) {
                                try {
                                    const decrypted = await this.decryptData(data.data, this.encryptionKey);
                                    if (decrypted && Array.isArray(decrypted)) {
                                        this.wifiNetworks = decrypted.sort((a, b) => b.signal - a.signal);
                                    }
                                } catch (decryptErr) {
                                    console.error('Decryption failed:', decryptErr);
                                }
                            } else if (Array.isArray(data)) {
                                // Unencrypted response (plain=1 or server without crypto)
                                this.wifiNetworks = data.sort((a, b) => b.signal - a.signal);
                            } else if (data.networks && Array.isArray(data.networks)) {
                                // Alternative response format
                                this.wifiNetworks = data.networks.sort((a, b) => b.signal - a.signal);
                            }
                        }
                    } catch (e) {
                        console.error('Failed to scan WiFi:', e);
                    }
                    
                    this.wifiScanning = false;
                },
                
                selectNetwork(ssid) {
                    if (this.selectedNetwork === ssid) {
                        // Clicking same network deselects
                        this.selectedNetwork = null;
                        this.wifiPassword = '';
                    } else {
                        this.selectedNetwork = ssid;
                        this.wifiPassword = '';
                        // Focus the password input after expand animation completes
                        // The resize handler will then scroll it into view when keyboard appears
                        this.$nextTick(() => {
                            setTimeout(() => {
                                const input = document.querySelector('.wifi-bubble.selected .password-field input');
                                if (input) input.focus();
                            }, 350);
                        });
                    }
                },
                
                async startGermination() {
                    if (!this.selectedNetwork || !this.wifiPassword) return;
                    
                    this.setupStep = 'germinate';
                    this.germinationProgress = 0;
                    this.germinationError = null;
                    
                    // Different stages for ISO vs installed mode
                    const isoStages = [
                        { progress: 5, status: 'Preparing soil...', detail: 'Setting up the garden bed' },
                        { progress: 10, status: 'Digging...', detail: 'Partitioning drive' },
                        { progress: 20, status: 'Enriching...', detail: 'Creating Btrfs subvolumes' },
                        { progress: 30, status: 'Seeding...', detail: 'Downloading easeOS' },
                        { progress: 50, status: 'Germinating...', detail: 'Installing NixOS (this takes a while)' },
                        { progress: 75, status: 'Growing...', detail: 'Configuring system' },
                        { progress: 85, status: 'Connecting roots...', detail: 'Connecting to ' + this.selectedNetwork },
                        { progress: 95, status: 'Blossoming...', detail: 'Finalizing installation' },
                    ];
                    
                    const installedStages = [
                        { progress: 10, status: 'Rooting...', detail: 'Finding nutrients in the soil' },
                        { progress: 25, status: 'Germinating...', detail: 'Creating your gardener account' },
                        { progress: 40, status: 'Sprouting...', detail: 'Encrypting credentials' },
                        { progress: 55, status: 'Growing...', detail: 'Connecting to ' + this.selectedNetwork },
                        { progress: 75, status: 'Blossoming...', detail: 'Establishing network roots' },
                        { progress: 90, status: 'Almost there...', detail: 'Configuring Cooper' },
                    ];
                    
                    const stages = this.isISOMode ? isoStages : installedStages;
                    
                    try {
                        // Stage 1: Preparing
                        this.germinationProgress = stages[0].progress;
                        this.germinationStatus = stages[0].status;
                        this.germinationDetail = stages[0].detail;
                        await this.sleep(500);
                        
                        // Create user account first (needed for install)
                        this.germinationProgress = this.isISOMode ? 8 : stages[1].progress;
                        this.germinationStatus = this.isISOMode ? 'Creating account...' : stages[1].status;
                        this.germinationDetail = 'Creating your gardener account';
                        
                        // Prepare account data with encryption
                        const accountData = {
                            username: this.setupUsername,
                            password: this.setupPassword,
                            hostname: this.setupHostname || 'easeos'
                        };
                        
                        let accountBody;
                        if (this.encryptionKey) {
                            const encryptedAccount = await this.encryptData(accountData, this.encryptionKey);
                            accountBody = JSON.stringify({ encrypted: true, data: encryptedAccount });
                        } else {
                            accountBody = JSON.stringify(accountData);
                        }
                        
                        const accountRes = await fetch('/api/setup/account', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: accountBody
                        });
                        
                        if (!accountRes.ok) {
                            const err = await accountRes.text();
                            throw new Error(err || 'Failed to create account');
                        }
                        
                        // ISO MODE: Start disk installation
                        if (this.isISOMode && this.selectedDrive) {
                            this.germinationProgress = stages[1].progress;
                            this.germinationStatus = stages[1].status;
                            this.germinationDetail = stages[1].detail;
                            
                            // Start the installation
                            const installRes = await fetch('/api/install/start', {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({
                                    drive: this.selectedDrive,
                                    encrypt: false, // TODO: add encryption option
                                    channel: 'stable'
                                })
                            });
                            
                            if (!installRes.ok) {
                                const err = await installRes.json();
                                throw new Error(err.error || 'Failed to start installation');
                            }
                            
                            // Poll installation progress
                            let installComplete = false;
                            let lastProgress = 10;
                            
                            while (!installComplete) {
                                await this.sleep(2000);
                                
                                try {
                                    const statusRes = await fetch('/api/install/status');
                                    if (statusRes.ok) {
                                        const status = await statusRes.json();
                                        
                                        if (status.error) {
                                            throw new Error(status.error);
                                        }
                                        
                                        // Map install progress to germination progress (10-85%)
                                        const mappedProgress = 10 + (status.progress * 0.75);
                                        if (mappedProgress > lastProgress) {
                                            lastProgress = mappedProgress;
                                            this.germinationProgress = Math.round(mappedProgress);
                                        }
                                        
                                        this.germinationStatus = status.stage === 'installing' ? 'Germinating...' : 
                                                                 status.stage === 'partitioning' ? 'Digging...' :
                                                                 status.stage === 'formatting' ? 'Enriching...' :
                                                                 status.stage === 'cloning' ? 'Seeding...' :
                                                                 status.stage === 'complete' ? 'Grown!' : 'Growing...';
                                        this.germinationDetail = status.message || 'Installing NixOS...';
                                        
                                        if (status.complete) {
                                            installComplete = true;
                                        }
                                        
                                        if (!status.running && !status.complete) {
                                            // Service stopped but not complete - check for error
                                            if (status.progress < 100) {
                                                throw new Error('Installation stopped unexpectedly');
                                            }
                                        }
                                    }
                                } catch (pollError) {
                                    console.error('Poll error:', pollError);
                                    // Continue polling unless it's a real error
                                    if (pollError.message && !pollError.message.includes('fetch')) {
                                        throw pollError;
                                    }
                                }
                            }
                        }
                        
                        // Stage: Encrypting/preparing WiFi
                        this.germinationProgress = this.isISOMode ? 87 : stages[2].progress;
                        this.germinationStatus = 'Sprouting...';
                        this.germinationDetail = 'Encrypting credentials';
                        
                        // Encrypt WiFi credentials before sending
                        const credentials = {
                            ssid: this.selectedNetwork,
                            password: this.wifiPassword
                        };
                        
                        let wifiBody;
                        if (this.encryptionKey) {
                            const encryptedData = await this.encryptData(credentials, this.encryptionKey);
                            wifiBody = JSON.stringify({ encrypted: true, data: encryptedData });
                        } else {
                            wifiBody = JSON.stringify(credentials);
                        }
                        
                        await this.sleep(400);
                        
                        // Connect to WiFi
                        this.germinationProgress = this.isISOMode ? 90 : stages[3].progress;
                        this.germinationStatus = 'Growing...';
                        this.germinationDetail = 'Connecting to ' + this.selectedNetwork;
                        
                        const wifiRes = await fetch('/api/wifi/connect', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: wifiBody
                        });
                        
                        if (!wifiRes.ok) {
                            const err = await wifiRes.text();
                            throw new Error(err || 'WiFi connection failed');
                        }
                        
                        // Check the actual success status in response
                        const wifiResult = await wifiRes.json();
                        if (!wifiResult.success) {
                            throw new Error(wifiResult.error || 'WiFi connection failed - check your password');
                        }
                        
                        // Finalizing
                        this.germinationProgress = this.isISOMode ? 95 : stages[4].progress;
                        this.germinationStatus = 'Blossoming...';
                        this.germinationDetail = 'Finalizing setup';
                        await this.sleep(500);
                        
                        // Complete!
                        this.germinationProgress = 100;
                        this.germinationStatus = this.isISOMode ? 'Planted!' : 'Planted!';
                        this.germinationDetail = this.isISOMode ? 'Cooper is installed! Reboot to start.' : 'Cooper is taking root';
                        await this.sleep(1000);
                        this.setupStep = 'alive';
                        
                    } catch (e) {
                        console.error('Setup failed:', e);
                        this.germinationError = e.message || 'Something went wrong. Please try again.';
                        this.germinationStatus = 'Wilted...';
                        this.germinationDetail = 'Installation failed';
                        // Stay on germinate page with error - don't auto-redirect
                        // User can click "Try Again" button to go back to soil step
                    }
                },
                
                async completeSetup() {
                    // Update config mode to 'normal'
                    try {
                        const res = await fetch('/api/config', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ ...this.config, mode: 'normal' })
                        });
                        
                        if (res.ok) {
                            this.config.mode = 'normal';
                            this.setupMode = false;
                        }
                    } catch (e) {
                        console.error('Failed to complete setup:', e);
                    }
                    
                    this.setupMode = false;
                },
                
                async rebootSystem() {
                    // Trigger system reboot (ISO mode only)
                    try {
                        await fetch('/api/system/reboot', {
                            method: 'POST'
                        });
                    } catch (e) {
                        // Expected - connection will drop
                        console.log('Reboot initiated');
                    }
                    
                    // Show rebooting message
                    this.germinationStatus = 'Rebooting...';
                    this.germinationDetail = 'See you on the other side!';
                },
                
                sleep(ms) {
                    return new Promise(resolve => setTimeout(resolve, ms));
                },
                
                // ===== END SETUP WIZARD =====
                
                async loadStoreApps() {
                    this.storeLoading = true;
                    try {
                        // Fetch all app JSONs from GitHub in parallel
                        const fetchPromises = this.storeAppFiles.map(async (appId) => {
                            const url = `${this.githubStoreUrl}/${appId}.json`;
                            const res = await fetch(url, { cache: 'no-store' });
                            if (res.ok) {
                                return await res.json();
                            }
                            return null;
                        });
                        
                        const apps = await Promise.all(fetchPromises);
                        this.storeApps = apps.filter(app => app !== null);
                        
                        // Extract categories
                        this.storeCategories = [...new Set(this.storeApps.map(a => a.category).filter(Boolean))];
                        console.log(`Store loaded ${this.storeApps.length} apps from GitHub`);
                    } catch (e) {
                        console.error('Failed to load store apps from GitHub:', e);
                        // Fallback to local API
                        try {
                            const localRes = await fetch('/api/store/apps');
                            if (localRes.ok) {
                                this.storeApps = await localRes.json();
                                this.storeCategories = [...new Set(this.storeApps.map(a => a.category).filter(Boolean))];
                            }
                        } catch (e2) {
                            console.error('Local store fallback also failed:', e2);
                        }
                    } finally {
                        this.storeLoading = false;
                    }
                },
                
                getStoreApp(appId) {
                    return this.storeApps.find(a => a.id === appId);
                },
                
                // Default icon SVG for apps without custom icons
                defaultAppIcon: '<svg viewBox="0 0 24 24" fill="white" class="w-full h-full"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>',
                
                // Get app icon with fallback to default
                getAppIcon(app) {
                    if (app?.icon && app.icon.trim()) {
                        return app.icon;
                    }
                    return this.defaultAppIcon;
                },
                
                // Get gradient from app colors (defined in JSON)
                getAppGradient(app) {
                    if (app?.colors?.gradient) {
                        return app.colors.gradient;
                    }
                    // Fallback: use primary color if available
                    if (app?.colors?.primary) {
                        return `linear-gradient(135deg, ${app.colors.primary} 0%, ${app.colors.primary}dd 100%)`;
                    }
                    return 'linear-gradient(135deg, #22C55E 0%, #4ADE80 100%)';
                },
                
                updateTimeOfDay() {
                    // If manual override, use that
                    if (this.manualThemeOverride) {
                        this.timeOfDay = this.manualThemeOverride === 'night' ? 'night' : 
                                         this.manualThemeOverride === 'sunrise' ? 'sunrise' :
                                         this.manualThemeOverride === 'sunset' ? 'sunset' : 'day';
                        if (this.timeOfDay === 'night' && !this.starsGenerated) {
                            this.$nextTick(() => this.generateStars());
                        }
                        return;
                    }
                    
                    // Auto-detect based on actual local time
                    const now = new Date();
                    const hour = now.getHours();
                    let newTimeOfDay;
                    
                    // Time ranges:
                    // 6-9: sunrise
                    // 9-17: day  
                    // 17-20: sunset
                    // 20-6: night
                    if (hour >= 6 && hour < 9) {
                        newTimeOfDay = 'sunrise';
                    } else if (hour >= 9 && hour < 17) {
                        newTimeOfDay = 'day';
                    } else if (hour >= 17 && hour < 20) {
                        newTimeOfDay = 'sunset';
                    } else {
                        newTimeOfDay = 'night';
                    }
                    
                    console.log(`Time: ${now.toLocaleTimeString()}, Hour: ${hour}, Theme: ${newTimeOfDay}`);
                    
                    if (newTimeOfDay !== this.timeOfDay) {
                        this.timeOfDay = newTimeOfDay;
                        
                        if (this.timeOfDay === 'night' && !this.starsGenerated) {
                            this.$nextTick(() => this.generateStars());
                        }
                    }
                },
                
                toggleTheme() {
                    // Cycle through: auto -> manual night -> manual day -> auto
                    if (this.manualThemeOverride === null) {
                        this.manualThemeOverride = 'night';
                    } else if (this.manualThemeOverride === 'night') {
                        this.manualThemeOverride = 'day';
                    } else {
                        this.manualThemeOverride = null;
                    }
                    
                    localStorage.setItem('easeOS-theme', this.manualThemeOverride || 'auto');
                    this.updateTimeOfDay();
                },
                
                scheduleShootingStar() {
                    // Random interval between 45-75 minutes (average 1 hour)
                    const minInterval = 45 * 60 * 1000; // 45 minutes
                    const maxInterval = 75 * 60 * 1000; // 75 minutes
                    const interval = Math.random() * (maxInterval - minInterval) + minInterval;
                    
                    this.shootingStarTimer = setTimeout(() => {
                        this.triggerShootingStar();
                        this.scheduleShootingStar(); // Schedule next one
                    }, interval);
                },
                
                triggerShootingStar() {
                    if (this.timeOfDay !== 'night') return;
                    
                    const star = this.$refs.shootingStar;
                    if (!star) return;
                    
                    // Randomize position
                    star.style.top = (Math.random() * 30 + 5) + '%';
                    star.style.left = (Math.random() * 40 + 10) + '%';
                    
                    // Trigger animation
                    star.classList.remove('active');
                    void star.offsetWidth; // Force reflow
                    star.classList.add('active');
                    
                    // Remove class after animation
                    setTimeout(() => star.classList.remove('active'), 2000);
                },
                
                generateStars() {
                    if (this.starsGenerated) return;
                    
                    const container = this.$refs.starsContainer;
                    if (!container) return;
                    
                    // Generate random stars
                    for (let i = 0; i < 100; i++) {
                        const star = document.createElement('div');
                        star.className = 'star';
                        star.style.left = Math.random() * 100 + '%';
                        star.style.top = Math.random() * 100 + '%';
                        star.style.width = (Math.random() * 3 + 1) + 'px';
                        star.style.height = star.style.width;
                        star.style.setProperty('--duration', (Math.random() * 3 + 2) + 's');
                        star.style.setProperty('--delay', (Math.random() * 5) + 's');
                        container.appendChild(star);
                    }
                    
                    this.starsGenerated = true;
                },
                
                handleResize() {
                    this.isMobile = window.innerWidth < 768;
                    if (!this.isMobile) {
                        this.sidebarOpen = false;
                    }
                },
                
                updateClock() {
                    this.clock = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                },
                
                async loadConfig() {
                    try {
                        const res = await fetch('/api/config', {
                            signal: AbortSignal.timeout(10000)
                        });
                        this.config = await res.json();
                        this.originalConfig = JSON.parse(JSON.stringify(this.config));
                        this.configText = JSON.stringify(this.config, null, 2);
                        // Backup config locally in case of disconnection
                        this.lastConfigBackup = JSON.stringify(this.config);
                        localStorage.setItem('easeOS-config-backup', this.lastConfigBackup);
                    } catch (e) {
                        console.error('Failed to load config', e);
                        // Try to restore from local backup
                        const backup = localStorage.getItem('easeOS-config-backup');
                        if (backup) {
                            try {
                                this.config = JSON.parse(backup);
                                this.originalConfig = JSON.parse(backup);
                                this.configText = JSON.stringify(this.config, null, 2);
                                console.log('Restored config from local backup');
                            } catch (e2) {
                                this.config = { apps: {} };
                                this.originalConfig = { apps: {} };
                            }
                        } else {
                            this.config = { apps: {} };
                            this.originalConfig = { apps: {} };
                        }
                    }
                },
                
                getAppState(appName) {
                    const configEnabled = this.config.apps?.[appName]?.enable === true;
                    const originalEnabled = this.originalConfig.apps?.[appName]?.enable === true;
                    
                    if (configEnabled && originalEnabled) return 'installed';
                    if (configEnabled && !originalEnabled) return 'pending';
                    if (!configEnabled && originalEnabled) return 'pending';
                    return 'available';
                },
                
                toggleApp(appName) {
                    if (!this.config.apps) this.config.apps = {};
                    if (!this.config.apps[appName]) this.config.apps[appName] = {};
                    
                    this.config.apps[appName].enable = !this.config.apps[appName].enable;
                    this.configText = JSON.stringify(this.config, null, 2);
                    
                    this.saveConfig();
                },
                
                onConfigEdit() {
                    try {
                        this.config = JSON.parse(this.configText);
                    } catch (e) {}
                },
                
                onConfigChange() {
                    // Update the JSON text to match the form changes
                    this.configText = JSON.stringify(this.config, null, 2);
                    this.saveConfig();
                },
                
                async saveConfig() {
                    try {
                        await fetch('/api/config', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(this.config),
                            signal: AbortSignal.timeout(10000)
                        });
                        // Update local backup
                        localStorage.setItem('easeOS-config-backup', JSON.stringify(this.config));
                    } catch (e) {
                        console.error('Failed to save config', e);
                        // Store pending changes locally
                        localStorage.setItem('easeOS-pending-config', JSON.stringify(this.config));
                    }
                },
                
                revertAll() {
                    this.config = JSON.parse(JSON.stringify(this.originalConfig));
                    this.configText = JSON.stringify(this.config, null, 2);
                    this.saveConfig();
                },
                
                async applyChanges() {
                    if (this.systemStatus === 'active') return;
                    
                    await this.saveConfig();
                    await fetch('/api/apply', { method: 'POST' });
                    
                    this.originalConfig = JSON.parse(JSON.stringify(this.config));
                    
                    // Skip garden animation and go directly to logs
                    this.currentView = 'logs';
                },
                
                async pollStatus() {
                    try {
                        const res = await fetch('/api/status', { 
                            signal: AbortSignal.timeout(5000) 
                        });
                        const data = await res.json();
                        
                        // Connection restored
                        if (!this.isConnected) {
                            this.isConnected = true;
                            this.reconnectAttempts = 0;
                            console.log('Connection restored');
                            // Reload config in case it changed
                            await this.loadConfig();
                        }
                        
                        this.systemStatus = data.active || 'inactive';
                        this.greenhouseMode = data.greenhouseMode || false;
                        this.greenhouseSSID = data.greenhouseSSID || null;
                        this.greenhousePassword = data.greenhousePassword || null;
                        this.connectedDevices = data.connectedDevices || 0;
                        if (data.log) {
                            this.logOutput = data.log;
                        }
                    } catch (e) {
                        // Connection lost
                        if (this.isConnected) {
                            this.isConnected = false;
                            console.log('Connection lost, will retry...');
                        }
                        this.reconnectAttempts++;
                        
                        // Add connection status to log
                        if (this.reconnectAttempts > 1) {
                            this.logOutput = `[Connection lost - Retrying... (${this.reconnectAttempts})]\n\n` + (this.logOutput || '');
                        }
                    }
                    
                    // Adjust poll interval based on connection status
                    const pollInterval = this.isConnected ? 1000 : Math.min(5000, 1000 * this.reconnectAttempts);
                    setTimeout(() => this.pollStatus(), pollInterval);
                },
                
                startWatering(context = 'main') {
                    this.isWatering = true;
                    this.createWaterDrop(context);
                    this.wateringTimer = setInterval(() => {
                        this.createWaterDrop(context);
                    }, 150);
                    
                    // Make plant happy after watering for a bit
                    setTimeout(() => {
                        if (this.isWatering) {
                            this.makeHappy();
                        }
                    }, 500);
                },
                
                stopWatering() {
                    this.isWatering = false;
                    if (this.wateringTimer) {
                        clearInterval(this.wateringTimer);
                        this.wateringTimer = null;
                    }
                },
                
                createWaterDrop(context = 'main') {
                    // Select the appropriate container based on context
                    let container;
                    if (context === 'wake') {
                        container = this.$refs.wakeWaterDrops;
                    } else if (context === 'mobile') {
                        container = this.$refs.mobileWaterDrops;
                    } else {
                        container = this.$refs.waterDrops;
                    }
                    if (!container) return;
                    
                    const drop = document.createElement('div');
                    drop.className = 'water-drop';
                    drop.style.left = (Math.random() * 40 + 10) + 'px';
                    drop.style.top = '5px';
                    drop.style.animationDelay = (Math.random() * 0.2) + 's';
                    container.appendChild(drop);
                    
                    setTimeout(() => drop.remove(), 700);
                },
                
                makeHappy() {
                    if (this.happyTimer) clearTimeout(this.happyTimer);
                    this.isHappy = true;
                    this.happyTimer = setTimeout(() => {
                        this.isHappy = false;
                    }, 2000);
                }
            };
        }
    </script>
</body>
</html>
